var dn=Object.defineProperty;var st=t=>{throw TypeError(t)};var pn=(t,e,n)=>e in t?dn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var K=(t,e,n)=>pn(t,typeof e!="symbol"?e+"":e,n),rt=(t,e,n)=>e.has(t)||st("Cannot "+n);var _=(t,e,n)=>(rt(t,e,"read from private field"),n?n.call(t):e.get(t)),M=(t,e,n)=>e.has(t)?st("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),J=(t,e,n,s)=>(rt(t,e,"write to private field"),s?s.call(t,n):e.set(t,n),n);function Tt(t,e){return function(){return t.apply(e,arguments)}}const{toString:mn}=Object.prototype,{getPrototypeOf:Xe}=Object,Ae=(t=>e=>{const n=mn.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),N=t=>(t=t.toLowerCase(),e=>Ae(e)===t),Oe=t=>e=>typeof e===t,{isArray:oe}=Array,fe=Oe("undefined");function _n(t){return t!==null&&!fe(t)&&t.constructor!==null&&!fe(t.constructor)&&L(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const vt=N("ArrayBuffer");function bn(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&vt(t.buffer),e}const gn=Oe("string"),L=Oe("function"),Rt=Oe("number"),xe=t=>t!==null&&typeof t=="object",yn=t=>t===!0||t===!1,be=t=>{if(Ae(t)!=="object")return!1;const e=Xe(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},wn=N("Date"),Sn=N("File"),En=N("Blob"),Tn=N("FileList"),vn=t=>xe(t)&&L(t.pipe),Rn=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||L(t.append)&&((e=Ae(t))==="formdata"||e==="object"&&L(t.toString)&&t.toString()==="[object FormData]"))},Cn=N("URLSearchParams"),[Pn,An,On,xn]=["ReadableStream","Request","Response","Headers"].map(N),kn=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function pe(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let s,r;if(typeof t!="object"&&(t=[t]),oe(t))for(s=0,r=t.length;s<r;s++)e.call(null,t[s],s,t);else{const i=n?Object.getOwnPropertyNames(t):Object.keys(t),o=i.length;let a;for(s=0;s<o;s++)a=i[s],e.call(null,t[a],a,t)}}function Ct(t,e){e=e.toLowerCase();const n=Object.keys(t);let s=n.length,r;for(;s-- >0;)if(r=n[s],e===r.toLowerCase())return r;return null}const X=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Pt=t=>!fe(t)&&t!==X;function Me(){const{caseless:t}=Pt(this)&&this||{},e={},n=(s,r)=>{const i=t&&Ct(e,r)||r;be(e[i])&&be(s)?e[i]=Me(e[i],s):be(s)?e[i]=Me({},s):oe(s)?e[i]=s.slice():e[i]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&pe(arguments[s],n);return e}const Dn=(t,e,n,{allOwnKeys:s}={})=>(pe(e,(r,i)=>{n&&L(r)?t[i]=Tt(r,n):t[i]=r},{allOwnKeys:s}),t),Ln=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Un=(t,e,n,s)=>{t.prototype=Object.create(e.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},Nn=(t,e,n,s)=>{let r,i,o;const a={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),i=r.length;i-- >0;)o=r[i],(!s||s(o,t,e))&&!a[o]&&(e[o]=t[o],a[o]=!0);t=n!==!1&&Xe(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},In=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const s=t.indexOf(e,n);return s!==-1&&s===n},jn=t=>{if(!t)return null;if(oe(t))return t;let e=t.length;if(!Rt(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},Bn=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Xe(Uint8Array)),Kn=(t,e)=>{const s=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=s.next())&&!r.done;){const i=r.value;e.call(t,i[0],i[1])}},Wn=(t,e)=>{let n;const s=[];for(;(n=t.exec(e))!==null;)s.push(n);return s},Fn=N("HTMLFormElement"),Hn=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,r){return s.toUpperCase()+r}),it=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),Mn=N("RegExp"),At=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),s={};pe(n,(r,i)=>{let o;(o=e(r,i,t))!==!1&&(s[i]=o||r)}),Object.defineProperties(t,s)},Jn=t=>{At(t,(e,n)=>{if(L(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=t[n];if(L(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},zn=(t,e)=>{const n={},s=r=>{r.forEach(i=>{n[i]=!0})};return oe(t)?s(t):s(String(t).split(e)),n},qn=()=>{},$n=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function Vn(t){return!!(t&&L(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const Gn=t=>{const e=new Array(10),n=(s,r)=>{if(xe(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[r]=s;const i=oe(s)?[]:{};return pe(s,(o,a)=>{const u=n(o,r+1);!fe(u)&&(i[a]=u)}),e[r]=void 0,i}}return s};return n(t,0)},Xn=N("AsyncFunction"),Zn=t=>t&&(xe(t)||L(t))&&L(t.then)&&L(t.catch),Ot=((t,e)=>t?setImmediate:e?((n,s)=>(X.addEventListener("message",({source:r,data:i})=>{r===X&&i===n&&s.length&&s.shift()()},!1),r=>{s.push(r),X.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",L(X.postMessage)),Qn=typeof queueMicrotask<"u"?queueMicrotask.bind(X):typeof process<"u"&&process.nextTick||Ot,c={isArray:oe,isArrayBuffer:vt,isBuffer:_n,isFormData:Rn,isArrayBufferView:bn,isString:gn,isNumber:Rt,isBoolean:yn,isObject:xe,isPlainObject:be,isReadableStream:Pn,isRequest:An,isResponse:On,isHeaders:xn,isUndefined:fe,isDate:wn,isFile:Sn,isBlob:En,isRegExp:Mn,isFunction:L,isStream:vn,isURLSearchParams:Cn,isTypedArray:Bn,isFileList:Tn,forEach:pe,merge:Me,extend:Dn,trim:kn,stripBOM:Ln,inherits:Un,toFlatObject:Nn,kindOf:Ae,kindOfTest:N,endsWith:In,toArray:jn,forEachEntry:Kn,matchAll:Wn,isHTMLForm:Fn,hasOwnProperty:it,hasOwnProp:it,reduceDescriptors:At,freezeMethods:Jn,toObjectSet:zn,toCamelCase:Hn,noop:qn,toFiniteNumber:$n,findKey:Ct,global:X,isContextDefined:Pt,isSpecCompliantForm:Vn,toJSONObject:Gn,isAsyncFn:Xn,isThenable:Zn,setImmediate:Ot,asap:Qn};function y(t,e,n,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),s&&(this.request=s),r&&(this.response=r,this.status=r.status?r.status:null)}c.inherits(y,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:c.toJSONObject(this.config),code:this.code,status:this.status}}});const xt=y.prototype,kt={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{kt[t]={value:t}});Object.defineProperties(y,kt);Object.defineProperty(xt,"isAxiosError",{value:!0});y.from=(t,e,n,s,r,i)=>{const o=Object.create(xt);return c.toFlatObject(t,o,function(u){return u!==Error.prototype},a=>a!=="isAxiosError"),y.call(o,t.message,e,n,s,r),o.cause=t,o.name=t.name,i&&Object.assign(o,i),o};const Yn=null;function Je(t){return c.isPlainObject(t)||c.isArray(t)}function Dt(t){return c.endsWith(t,"[]")?t.slice(0,-2):t}function ot(t,e,n){return t?t.concat(e).map(function(r,i){return r=Dt(r),!n&&i?"["+r+"]":r}).join(n?".":""):e}function es(t){return c.isArray(t)&&!t.some(Je)}const ts=c.toFlatObject(c,{},null,function(e){return/^is[A-Z]/.test(e)});function ke(t,e,n){if(!c.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=c.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,f){return!c.isUndefined(f[m])});const s=n.metaTokens,r=n.visitor||h,i=n.dots,o=n.indexes,u=(n.Blob||typeof Blob<"u"&&Blob)&&c.isSpecCompliantForm(e);if(!c.isFunction(r))throw new TypeError("visitor must be a function");function l(p){if(p===null)return"";if(c.isDate(p))return p.toISOString();if(!u&&c.isBlob(p))throw new y("Blob is not supported. Use a Buffer instead.");return c.isArrayBuffer(p)||c.isTypedArray(p)?u&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function h(p,m,f){let S=p;if(p&&!f&&typeof p=="object"){if(c.endsWith(m,"{}"))m=s?m:m.slice(0,-2),p=JSON.stringify(p);else if(c.isArray(p)&&es(p)||(c.isFileList(p)||c.endsWith(m,"[]"))&&(S=c.toArray(p)))return m=Dt(m),S.forEach(function(P,B){!(c.isUndefined(P)||P===null)&&e.append(o===!0?ot([m],B,i):o===null?m:m+"[]",l(P))}),!1}return Je(p)?!0:(e.append(ot(f,m,i),l(p)),!1)}const d=[],g=Object.assign(ts,{defaultVisitor:h,convertValue:l,isVisitable:Je});function b(p,m){if(!c.isUndefined(p)){if(d.indexOf(p)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(p),c.forEach(p,function(S,C){(!(c.isUndefined(S)||S===null)&&r.call(e,S,c.isString(C)?C.trim():C,m,g))===!0&&b(S,m?m.concat(C):[C])}),d.pop()}}if(!c.isObject(t))throw new TypeError("data must be an object");return b(t),e}function at(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function Ze(t,e){this._pairs=[],t&&ke(t,this,e)}const Lt=Ze.prototype;Lt.append=function(e,n){this._pairs.push([e,n])};Lt.toString=function(e){const n=e?function(s){return e.call(this,s,at)}:at;return this._pairs.map(function(r){return n(r[0])+"="+n(r[1])},"").join("&")};function ns(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ut(t,e,n){if(!e)return t;const s=n&&n.encode||ns;c.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let i;if(r?i=r(e,n):i=c.isURLSearchParams(e)?e.toString():new Ze(e,n).toString(s),i){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class ct{constructor(){this.handlers=[]}use(e,n,s){return this.handlers.push({fulfilled:e,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){c.forEach(this.handlers,function(s){s!==null&&e(s)})}}const Nt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ss=typeof URLSearchParams<"u"?URLSearchParams:Ze,rs=typeof FormData<"u"?FormData:null,is=typeof Blob<"u"?Blob:null,os={isBrowser:!0,classes:{URLSearchParams:ss,FormData:rs,Blob:is},protocols:["http","https","file","blob","url","data"]},Qe=typeof window<"u"&&typeof document<"u",ze=typeof navigator=="object"&&navigator||void 0,as=Qe&&(!ze||["ReactNative","NativeScript","NS"].indexOf(ze.product)<0),cs=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",us=Qe&&window.location.href||"http://localhost",ls=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Qe,hasStandardBrowserEnv:as,hasStandardBrowserWebWorkerEnv:cs,navigator:ze,origin:us},Symbol.toStringTag,{value:"Module"})),A={...ls,...os};function hs(t,e){return ke(t,new A.classes.URLSearchParams,Object.assign({visitor:function(n,s,r,i){return A.isNode&&c.isBuffer(n)?(this.append(s,n.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function fs(t){return c.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ds(t){const e={},n=Object.keys(t);let s;const r=n.length;let i;for(s=0;s<r;s++)i=n[s],e[i]=t[i];return e}function It(t){function e(n,s,r,i){let o=n[i++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),u=i>=n.length;return o=!o&&c.isArray(r)?r.length:o,u?(c.hasOwnProp(r,o)?r[o]=[r[o],s]:r[o]=s,!a):((!r[o]||!c.isObject(r[o]))&&(r[o]=[]),e(n,s,r[o],i)&&c.isArray(r[o])&&(r[o]=ds(r[o])),!a)}if(c.isFormData(t)&&c.isFunction(t.entries)){const n={};return c.forEachEntry(t,(s,r)=>{e(fs(s),r,n,0)}),n}return null}function ps(t,e,n){if(c.isString(t))try{return(e||JSON.parse)(t),c.trim(t)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(t)}const me={transitional:Nt,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const s=n.getContentType()||"",r=s.indexOf("application/json")>-1,i=c.isObject(e);if(i&&c.isHTMLForm(e)&&(e=new FormData(e)),c.isFormData(e))return r?JSON.stringify(It(e)):e;if(c.isArrayBuffer(e)||c.isBuffer(e)||c.isStream(e)||c.isFile(e)||c.isBlob(e)||c.isReadableStream(e))return e;if(c.isArrayBufferView(e))return e.buffer;if(c.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return hs(e,this.formSerializer).toString();if((a=c.isFileList(e))||s.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return ke(a?{"files[]":e}:e,u&&new u,this.formSerializer)}}return i||r?(n.setContentType("application/json",!1),ps(e)):e}],transformResponse:[function(e){const n=this.transitional||me.transitional,s=n&&n.forcedJSONParsing,r=this.responseType==="json";if(c.isResponse(e)||c.isReadableStream(e))return e;if(e&&c.isString(e)&&(s&&!this.responseType||r)){const o=!(n&&n.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?y.from(a,y.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:A.classes.FormData,Blob:A.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};c.forEach(["delete","get","head","post","put","patch"],t=>{me.headers[t]={}});const ms=c.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_s=t=>{const e={};let n,s,r;return t&&t.split(`
`).forEach(function(o){r=o.indexOf(":"),n=o.substring(0,r).trim().toLowerCase(),s=o.substring(r+1).trim(),!(!n||e[n]&&ms[n])&&(n==="set-cookie"?e[n]?e[n].push(s):e[n]=[s]:e[n]=e[n]?e[n]+", "+s:s)}),e},ut=Symbol("internals");function ce(t){return t&&String(t).trim().toLowerCase()}function ge(t){return t===!1||t==null?t:c.isArray(t)?t.map(ge):String(t)}function bs(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(t);)e[s[1]]=s[2];return e}const gs=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function je(t,e,n,s,r){if(c.isFunction(s))return s.call(this,e,n);if(r&&(e=n),!!c.isString(e)){if(c.isString(s))return e.indexOf(s)!==-1;if(c.isRegExp(s))return s.test(e)}}function ys(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,s)=>n.toUpperCase()+s)}function ws(t,e){const n=c.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(t,s+n,{value:function(r,i,o){return this[s].call(this,e,r,i,o)},configurable:!0})})}let k=class{constructor(e){e&&this.set(e)}set(e,n,s){const r=this;function i(a,u,l){const h=ce(u);if(!h)throw new Error("header name must be a non-empty string");const d=c.findKey(r,h);(!d||r[d]===void 0||l===!0||l===void 0&&r[d]!==!1)&&(r[d||u]=ge(a))}const o=(a,u)=>c.forEach(a,(l,h)=>i(l,h,u));if(c.isPlainObject(e)||e instanceof this.constructor)o(e,n);else if(c.isString(e)&&(e=e.trim())&&!gs(e))o(_s(e),n);else if(c.isHeaders(e))for(const[a,u]of e.entries())i(u,a,s);else e!=null&&i(n,e,s);return this}get(e,n){if(e=ce(e),e){const s=c.findKey(this,e);if(s){const r=this[s];if(!n)return r;if(n===!0)return bs(r);if(c.isFunction(n))return n.call(this,r,s);if(c.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=ce(e),e){const s=c.findKey(this,e);return!!(s&&this[s]!==void 0&&(!n||je(this,this[s],s,n)))}return!1}delete(e,n){const s=this;let r=!1;function i(o){if(o=ce(o),o){const a=c.findKey(s,o);a&&(!n||je(s,s[a],a,n))&&(delete s[a],r=!0)}}return c.isArray(e)?e.forEach(i):i(e),r}clear(e){const n=Object.keys(this);let s=n.length,r=!1;for(;s--;){const i=n[s];(!e||je(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){const n=this,s={};return c.forEach(this,(r,i)=>{const o=c.findKey(s,i);if(o){n[o]=ge(r),delete n[i];return}const a=e?ys(i):String(i).trim();a!==i&&delete n[i],n[a]=ge(r),s[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return c.forEach(this,(s,r)=>{s!=null&&s!==!1&&(n[r]=e&&c.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const s=new this(e);return n.forEach(r=>s.set(r)),s}static accessor(e){const s=(this[ut]=this[ut]={accessors:{}}).accessors,r=this.prototype;function i(o){const a=ce(o);s[a]||(ws(r,o),s[a]=!0)}return c.isArray(e)?e.forEach(i):i(e),this}};k.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);c.reduceDescriptors(k.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(s){this[n]=s}}});c.freezeMethods(k);function Be(t,e){const n=this||me,s=e||n,r=k.from(s.headers);let i=s.data;return c.forEach(t,function(a){i=a.call(n,i,r.normalize(),e?e.status:void 0)}),r.normalize(),i}function jt(t){return!!(t&&t.__CANCEL__)}function ae(t,e,n){y.call(this,t??"canceled",y.ERR_CANCELED,e,n),this.name="CanceledError"}c.inherits(ae,y,{__CANCEL__:!0});function Bt(t,e,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?t(n):e(new y("Request failed with status code "+n.status,[y.ERR_BAD_REQUEST,y.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Ss(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Es(t,e){t=t||10;const n=new Array(t),s=new Array(t);let r=0,i=0,o;return e=e!==void 0?e:1e3,function(u){const l=Date.now(),h=s[i];o||(o=l),n[r]=u,s[r]=l;let d=i,g=0;for(;d!==r;)g+=n[d++],d=d%t;if(r=(r+1)%t,r===i&&(i=(i+1)%t),l-o<e)return;const b=h&&l-h;return b?Math.round(g*1e3/b):void 0}}function Ts(t,e){let n=0,s=1e3/e,r,i;const o=(l,h=Date.now())=>{n=h,r=null,i&&(clearTimeout(i),i=null),t.apply(null,l)};return[(...l)=>{const h=Date.now(),d=h-n;d>=s?o(l,h):(r=l,i||(i=setTimeout(()=>{i=null,o(r)},s-d)))},()=>r&&o(r)]}const Se=(t,e,n=3)=>{let s=0;const r=Es(50,250);return Ts(i=>{const o=i.loaded,a=i.lengthComputable?i.total:void 0,u=o-s,l=r(u),h=o<=a;s=o;const d={loaded:o,total:a,progress:a?o/a:void 0,bytes:u,rate:l||void 0,estimated:l&&a&&h?(a-o)/l:void 0,event:i,lengthComputable:a!=null,[e?"download":"upload"]:!0};t(d)},n)},lt=(t,e)=>{const n=t!=null;return[s=>e[0]({lengthComputable:n,total:t,loaded:s}),e[1]]},ht=t=>(...e)=>c.asap(()=>t(...e)),vs=A.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,A.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(A.origin),A.navigator&&/(msie|trident)/i.test(A.navigator.userAgent)):()=>!0,Rs=A.hasStandardBrowserEnv?{write(t,e,n,s,r,i){const o=[t+"="+encodeURIComponent(e)];c.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),c.isString(s)&&o.push("path="+s),c.isString(r)&&o.push("domain="+r),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Cs(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Ps(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Kt(t,e,n){let s=!Cs(e);return t&&s||n==!1?Ps(t,e):e}const ft=t=>t instanceof k?{...t}:t;function Y(t,e){e=e||{};const n={};function s(l,h,d,g){return c.isPlainObject(l)&&c.isPlainObject(h)?c.merge.call({caseless:g},l,h):c.isPlainObject(h)?c.merge({},h):c.isArray(h)?h.slice():h}function r(l,h,d,g){if(c.isUndefined(h)){if(!c.isUndefined(l))return s(void 0,l,d,g)}else return s(l,h,d,g)}function i(l,h){if(!c.isUndefined(h))return s(void 0,h)}function o(l,h){if(c.isUndefined(h)){if(!c.isUndefined(l))return s(void 0,l)}else return s(void 0,h)}function a(l,h,d){if(d in e)return s(l,h);if(d in t)return s(void 0,l)}const u={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(l,h,d)=>r(ft(l),ft(h),d,!0)};return c.forEach(Object.keys(Object.assign({},t,e)),function(h){const d=u[h]||r,g=d(t[h],e[h],h);c.isUndefined(g)&&d!==a||(n[h]=g)}),n}const Wt=t=>{const e=Y({},t);let{data:n,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:i,headers:o,auth:a}=e;e.headers=o=k.from(o),e.url=Ut(Kt(e.baseURL,e.url),t.params,t.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let u;if(c.isFormData(n)){if(A.hasStandardBrowserEnv||A.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((u=o.getContentType())!==!1){const[l,...h]=u?u.split(";").map(d=>d.trim()).filter(Boolean):[];o.setContentType([l||"multipart/form-data",...h].join("; "))}}if(A.hasStandardBrowserEnv&&(s&&c.isFunction(s)&&(s=s(e)),s||s!==!1&&vs(e.url))){const l=r&&i&&Rs.read(i);l&&o.set(r,l)}return e},As=typeof XMLHttpRequest<"u",Os=As&&function(t){return new Promise(function(n,s){const r=Wt(t);let i=r.data;const o=k.from(r.headers).normalize();let{responseType:a,onUploadProgress:u,onDownloadProgress:l}=r,h,d,g,b,p;function m(){b&&b(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(h),r.signal&&r.signal.removeEventListener("abort",h)}let f=new XMLHttpRequest;f.open(r.method.toUpperCase(),r.url,!0),f.timeout=r.timeout;function S(){if(!f)return;const P=k.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders()),x={data:!a||a==="text"||a==="json"?f.responseText:f.response,status:f.status,statusText:f.statusText,headers:P,config:t,request:f};Bt(function($){n($),m()},function($){s($),m()},x),f=null}"onloadend"in f?f.onloadend=S:f.onreadystatechange=function(){!f||f.readyState!==4||f.status===0&&!(f.responseURL&&f.responseURL.indexOf("file:")===0)||setTimeout(S)},f.onabort=function(){f&&(s(new y("Request aborted",y.ECONNABORTED,t,f)),f=null)},f.onerror=function(){s(new y("Network Error",y.ERR_NETWORK,t,f)),f=null},f.ontimeout=function(){let B=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const x=r.transitional||Nt;r.timeoutErrorMessage&&(B=r.timeoutErrorMessage),s(new y(B,x.clarifyTimeoutError?y.ETIMEDOUT:y.ECONNABORTED,t,f)),f=null},i===void 0&&o.setContentType(null),"setRequestHeader"in f&&c.forEach(o.toJSON(),function(B,x){f.setRequestHeader(x,B)}),c.isUndefined(r.withCredentials)||(f.withCredentials=!!r.withCredentials),a&&a!=="json"&&(f.responseType=r.responseType),l&&([g,p]=Se(l,!0),f.addEventListener("progress",g)),u&&f.upload&&([d,b]=Se(u),f.upload.addEventListener("progress",d),f.upload.addEventListener("loadend",b)),(r.cancelToken||r.signal)&&(h=P=>{f&&(s(!P||P.type?new ae(null,t,f):P),f.abort(),f=null)},r.cancelToken&&r.cancelToken.subscribe(h),r.signal&&(r.signal.aborted?h():r.signal.addEventListener("abort",h)));const C=Ss(r.url);if(C&&A.protocols.indexOf(C)===-1){s(new y("Unsupported protocol "+C+":",y.ERR_BAD_REQUEST,t));return}f.send(i||null)})},xs=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let s=new AbortController,r;const i=function(l){if(!r){r=!0,a();const h=l instanceof Error?l:this.reason;s.abort(h instanceof y?h:new ae(h instanceof Error?h.message:h))}};let o=e&&setTimeout(()=>{o=null,i(new y(`timeout ${e} of ms exceeded`,y.ETIMEDOUT))},e);const a=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(l=>{l.unsubscribe?l.unsubscribe(i):l.removeEventListener("abort",i)}),t=null)};t.forEach(l=>l.addEventListener("abort",i));const{signal:u}=s;return u.unsubscribe=()=>c.asap(a),u}},ks=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let s=0,r;for(;s<n;)r=s+e,yield t.slice(s,r),s=r},Ds=async function*(t,e){for await(const n of Ls(t))yield*ks(n,e)},Ls=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:s}=await e.read();if(n)break;yield s}}finally{await e.cancel()}},dt=(t,e,n,s)=>{const r=Ds(t,e);let i=0,o,a=u=>{o||(o=!0,s&&s(u))};return new ReadableStream({async pull(u){try{const{done:l,value:h}=await r.next();if(l){a(),u.close();return}let d=h.byteLength;if(n){let g=i+=d;n(g)}u.enqueue(new Uint8Array(h))}catch(l){throw a(l),l}},cancel(u){return a(u),r.return()}},{highWaterMark:2})},De=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Ft=De&&typeof ReadableStream=="function",Us=De&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Ht=(t,...e)=>{try{return!!t(...e)}catch{return!1}},Ns=Ft&&Ht(()=>{let t=!1;const e=new Request(A.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),pt=64*1024,qe=Ft&&Ht(()=>c.isReadableStream(new Response("").body)),Ee={stream:qe&&(t=>t.body)};De&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Ee[e]&&(Ee[e]=c.isFunction(t[e])?n=>n[e]():(n,s)=>{throw new y(`Response type '${e}' is not supported`,y.ERR_NOT_SUPPORT,s)})})})(new Response);const Is=async t=>{if(t==null)return 0;if(c.isBlob(t))return t.size;if(c.isSpecCompliantForm(t))return(await new Request(A.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(c.isArrayBufferView(t)||c.isArrayBuffer(t))return t.byteLength;if(c.isURLSearchParams(t)&&(t=t+""),c.isString(t))return(await Us(t)).byteLength},js=async(t,e)=>{const n=c.toFiniteNumber(t.getContentLength());return n??Is(e)},Bs=De&&(async t=>{let{url:e,method:n,data:s,signal:r,cancelToken:i,timeout:o,onDownloadProgress:a,onUploadProgress:u,responseType:l,headers:h,withCredentials:d="same-origin",fetchOptions:g}=Wt(t);l=l?(l+"").toLowerCase():"text";let b=xs([r,i&&i.toAbortSignal()],o),p;const m=b&&b.unsubscribe&&(()=>{b.unsubscribe()});let f;try{if(u&&Ns&&n!=="get"&&n!=="head"&&(f=await js(h,s))!==0){let x=new Request(e,{method:"POST",body:s,duplex:"half"}),H;if(c.isFormData(s)&&(H=x.headers.get("content-type"))&&h.setContentType(H),x.body){const[$,_e]=lt(f,Se(ht(u)));s=dt(x.body,pt,$,_e)}}c.isString(d)||(d=d?"include":"omit");const S="credentials"in Request.prototype;p=new Request(e,{...g,signal:b,method:n.toUpperCase(),headers:h.normalize().toJSON(),body:s,duplex:"half",credentials:S?d:void 0});let C=await fetch(p);const P=qe&&(l==="stream"||l==="response");if(qe&&(a||P&&m)){const x={};["status","statusText","headers"].forEach(nt=>{x[nt]=C[nt]});const H=c.toFiniteNumber(C.headers.get("content-length")),[$,_e]=a&&lt(H,Se(ht(a),!0))||[];C=new Response(dt(C.body,pt,$,()=>{_e&&_e(),m&&m()}),x)}l=l||"text";let B=await Ee[c.findKey(Ee,l)||"text"](C,t);return!P&&m&&m(),await new Promise((x,H)=>{Bt(x,H,{data:B,headers:k.from(C.headers),status:C.status,statusText:C.statusText,config:t,request:p})})}catch(S){throw m&&m(),S&&S.name==="TypeError"&&/fetch/i.test(S.message)?Object.assign(new y("Network Error",y.ERR_NETWORK,t,p),{cause:S.cause||S}):y.from(S,S&&S.code,t,p)}}),$e={http:Yn,xhr:Os,fetch:Bs};c.forEach($e,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const mt=t=>`- ${t}`,Ks=t=>c.isFunction(t)||t===null||t===!1,Mt={getAdapter:t=>{t=c.isArray(t)?t:[t];const{length:e}=t;let n,s;const r={};for(let i=0;i<e;i++){n=t[i];let o;if(s=n,!Ks(n)&&(s=$e[(o=String(n)).toLowerCase()],s===void 0))throw new y(`Unknown adapter '${o}'`);if(s)break;r[o||"#"+i]=s}if(!s){const i=Object.entries(r).map(([a,u])=>`adapter ${a} `+(u===!1?"is not supported by the environment":"is not available in the build"));let o=e?i.length>1?`since :
`+i.map(mt).join(`
`):" "+mt(i[0]):"as no adapter specified";throw new y("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:$e};function Ke(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new ae(null,t)}function _t(t){return Ke(t),t.headers=k.from(t.headers),t.data=Be.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Mt.getAdapter(t.adapter||me.adapter)(t).then(function(s){return Ke(t),s.data=Be.call(t,t.transformResponse,s),s.headers=k.from(s.headers),s},function(s){return jt(s)||(Ke(t),s&&s.response&&(s.response.data=Be.call(t,t.transformResponse,s.response),s.response.headers=k.from(s.response.headers))),Promise.reject(s)})}const Jt="1.8.1",Le={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Le[t]=function(s){return typeof s===t||"a"+(e<1?"n ":" ")+t}});const bt={};Le.transitional=function(e,n,s){function r(i,o){return"[Axios v"+Jt+"] Transitional option '"+i+"'"+o+(s?". "+s:"")}return(i,o,a)=>{if(e===!1)throw new y(r(o," has been removed"+(n?" in "+n:"")),y.ERR_DEPRECATED);return n&&!bt[o]&&(bt[o]=!0,console.warn(r(o," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(i,o,a):!0}};Le.spelling=function(e){return(n,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function Ws(t,e,n){if(typeof t!="object")throw new y("options must be an object",y.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let r=s.length;for(;r-- >0;){const i=s[r],o=e[i];if(o){const a=t[i],u=a===void 0||o(a,i,t);if(u!==!0)throw new y("option "+i+" must be "+u,y.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new y("Unknown option "+i,y.ERR_BAD_OPTION)}}const ye={assertOptions:Ws,validators:Le},I=ye.validators;let Q=class{constructor(e){this.defaults=e,this.interceptors={request:new ct,response:new ct}}async request(e,n){try{return await this._request(e,n)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Y(this.defaults,n);const{transitional:s,paramsSerializer:r,headers:i}=n;s!==void 0&&ye.assertOptions(s,{silentJSONParsing:I.transitional(I.boolean),forcedJSONParsing:I.transitional(I.boolean),clarifyTimeoutError:I.transitional(I.boolean)},!1),r!=null&&(c.isFunction(r)?n.paramsSerializer={serialize:r}:ye.assertOptions(r,{encode:I.function,serialize:I.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),ye.assertOptions(n,{baseUrl:I.spelling("baseURL"),withXsrfToken:I.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let o=i&&c.merge(i.common,i[n.method]);i&&c.forEach(["delete","get","head","post","put","patch","common"],p=>{delete i[p]}),n.headers=k.concat(o,i);const a=[];let u=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(n)===!1||(u=u&&m.synchronous,a.unshift(m.fulfilled,m.rejected))});const l=[];this.interceptors.response.forEach(function(m){l.push(m.fulfilled,m.rejected)});let h,d=0,g;if(!u){const p=[_t.bind(this),void 0];for(p.unshift.apply(p,a),p.push.apply(p,l),g=p.length,h=Promise.resolve(n);d<g;)h=h.then(p[d++],p[d++]);return h}g=a.length;let b=n;for(d=0;d<g;){const p=a[d++],m=a[d++];try{b=p(b)}catch(f){m.call(this,f);break}}try{h=_t.call(this,b)}catch(p){return Promise.reject(p)}for(d=0,g=l.length;d<g;)h=h.then(l[d++],l[d++]);return h}getUri(e){e=Y(this.defaults,e);const n=Kt(e.baseURL,e.url,e.allowAbsoluteUrls);return Ut(n,e.params,e.paramsSerializer)}};c.forEach(["delete","get","head","options"],function(e){Q.prototype[e]=function(n,s){return this.request(Y(s||{},{method:e,url:n,data:(s||{}).data}))}});c.forEach(["post","put","patch"],function(e){function n(s){return function(i,o,a){return this.request(Y(a||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}Q.prototype[e]=n(),Q.prototype[e+"Form"]=n(!0)});let Fs=class zt{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(i){n=i});const s=this;this.promise.then(r=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](r);s._listeners=null}),this.promise.then=r=>{let i;const o=new Promise(a=>{s.subscribe(a),i=a}).then(r);return o.cancel=function(){s.unsubscribe(i)},o},e(function(i,o,a){s.reason||(s.reason=new ae(i,o,a),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=s=>{e.abort(s)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new zt(function(r){e=r}),cancel:e}}};function Hs(t){return function(n){return t.apply(null,n)}}function Ms(t){return c.isObject(t)&&t.isAxiosError===!0}const Ve={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ve).forEach(([t,e])=>{Ve[e]=t});function qt(t){const e=new Q(t),n=Tt(Q.prototype.request,e);return c.extend(n,Q.prototype,e,{allOwnKeys:!0}),c.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return qt(Y(t,r))},n}const v=qt(me);v.Axios=Q;v.CanceledError=ae;v.CancelToken=Fs;v.isCancel=jt;v.VERSION=Jt;v.toFormData=ke;v.AxiosError=y;v.Cancel=v.CanceledError;v.all=function(e){return Promise.all(e)};v.spread=Hs;v.isAxiosError=Ms;v.mergeConfig=Y;v.AxiosHeaders=k;v.formToJSON=t=>It(c.isHTMLForm(t)?new FormData(t):t);v.getAdapter=Mt.getAdapter;v.HttpStatusCode=Ve;v.default=v;const{Axios:Gr,AxiosError:Xr,CanceledError:Zr,isCancel:Qr,CancelToken:Yr,VERSION:ei,all:ti,Cancel:ni,isAxiosError:si,spread:ri,toFormData:ii,AxiosHeaders:oi,HttpStatusCode:ai,formToJSON:ci,getAdapter:ui,mergeConfig:li}=v;window.axios=v;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";function le(t,e,n,s){function r(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(h){try{l(s.next(h))}catch(d){o(d)}}function u(h){try{l(s.throw(h))}catch(d){o(d)}}function l(h){h.done?i(h.value):r(h.value).then(a,u)}l((s=s.apply(t,[])).next())})}function Js(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ye={exports:{}},se=typeof Reflect=="object"?Reflect:null,gt=se&&typeof se.apply=="function"?se.apply:function(e,n,s){return Function.prototype.apply.call(e,n,s)},we;se&&typeof se.ownKeys=="function"?we=se.ownKeys:Object.getOwnPropertySymbols?we=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:we=function(e){return Object.getOwnPropertyNames(e)};function zs(t){console&&console.warn&&console.warn(t)}var $t=Number.isNaN||function(e){return e!==e};function w(){w.init.call(this)}Ye.exports=w;Ye.exports.once=Gs;w.EventEmitter=w;w.prototype._events=void 0;w.prototype._eventsCount=0;w.prototype._maxListeners=void 0;var yt=10;function Ue(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(w,"defaultMaxListeners",{enumerable:!0,get:function(){return yt},set:function(t){if(typeof t!="number"||t<0||$t(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");yt=t}});w.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};w.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||$t(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Vt(t){return t._maxListeners===void 0?w.defaultMaxListeners:t._maxListeners}w.prototype.getMaxListeners=function(){return Vt(this)};w.prototype.emit=function(e){for(var n=[],s=1;s<arguments.length;s++)n.push(arguments[s]);var r=e==="error",i=this._events;if(i!==void 0)r=r&&i.error===void 0;else if(!r)return!1;if(r){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=i[e];if(u===void 0)return!1;if(typeof u=="function")gt(u,this,n);else for(var l=u.length,h=Yt(u,l),s=0;s<l;++s)gt(h[s],this,n);return!0};function Gt(t,e,n,s){var r,i,o;if(Ue(n),i=t._events,i===void 0?(i=t._events=Object.create(null),t._eventsCount=0):(i.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),o=i[e]),o===void 0)o=i[e]=n,++t._eventsCount;else if(typeof o=="function"?o=i[e]=s?[n,o]:[o,n]:s?o.unshift(n):o.push(n),r=Vt(t),r>0&&o.length>r&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,zs(a)}return t}w.prototype.addListener=function(e,n){return Gt(this,e,n,!1)};w.prototype.on=w.prototype.addListener;w.prototype.prependListener=function(e,n){return Gt(this,e,n,!0)};function qs(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Xt(t,e,n){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=qs.bind(s);return r.listener=n,s.wrapFn=r,r}w.prototype.once=function(e,n){return Ue(n),this.on(e,Xt(this,e,n)),this};w.prototype.prependOnceListener=function(e,n){return Ue(n),this.prependListener(e,Xt(this,e,n)),this};w.prototype.removeListener=function(e,n){var s,r,i,o,a;if(Ue(n),r=this._events,r===void 0)return this;if(s=r[e],s===void 0)return this;if(s===n||s.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,s.listener||n));else if(typeof s!="function"){for(i=-1,o=s.length-1;o>=0;o--)if(s[o]===n||s[o].listener===n){a=s[o].listener,i=o;break}if(i<0)return this;i===0?s.shift():$s(s,i),s.length===1&&(r[e]=s[0]),r.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};w.prototype.off=w.prototype.removeListener;w.prototype.removeAllListeners=function(e){var n,s,r;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var i=Object.keys(s),o;for(r=0;r<i.length;++r)o=i[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=s[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(r=n.length-1;r>=0;r--)this.removeListener(e,n[r]);return this};function Zt(t,e,n){var s=t._events;if(s===void 0)return[];var r=s[e];return r===void 0?[]:typeof r=="function"?n?[r.listener||r]:[r]:n?Vs(r):Yt(r,r.length)}w.prototype.listeners=function(e){return Zt(this,e,!0)};w.prototype.rawListeners=function(e){return Zt(this,e,!1)};w.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Qt.call(t,e)};w.prototype.listenerCount=Qt;function Qt(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}w.prototype.eventNames=function(){return this._eventsCount>0?we(this._events):[]};function Yt(t,e){for(var n=new Array(e),s=0;s<e;++s)n[s]=t[s];return n}function $s(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Vs(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function Gs(t,e){return new Promise(function(n,s){function r(o){t.removeListener(e,i),s(o)}function i(){typeof t.removeListener=="function"&&t.removeListener("error",r),n([].slice.call(arguments))}en(t,e,i,{once:!0}),e!=="error"&&Xs(t,r,{once:!0})})}function Xs(t,e,n){typeof t.on=="function"&&en(t,"error",e,n)}function en(t,e,n,s){if(typeof t.on=="function")s.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function r(i){s.once&&t.removeEventListener(e,r),n(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Zs=Ye.exports,tn=Js(Zs),E;(function(t){t[t.timeout=1]="timeout",t[t.transportClosed=2]="transportClosed",t[t.clientDisconnected=3]="clientDisconnected",t[t.clientClosed=4]="clientClosed",t[t.clientConnectToken=5]="clientConnectToken",t[t.clientRefreshToken=6]="clientRefreshToken",t[t.subscriptionUnsubscribed=7]="subscriptionUnsubscribed",t[t.subscriptionSubscribeToken=8]="subscriptionSubscribeToken",t[t.subscriptionRefreshToken=9]="subscriptionRefreshToken",t[t.transportWriteError=10]="transportWriteError",t[t.connectionClosed=11]="connectionClosed",t[t.badConfiguration=12]="badConfiguration"})(E||(E={}));var z;(function(t){t[t.connectCalled=0]="connectCalled",t[t.transportClosed=1]="transportClosed",t[t.noPing=2]="noPing",t[t.subscribeTimeout=3]="subscribeTimeout",t[t.unsubscribeError=4]="unsubscribeError"})(z||(z={}));var he;(function(t){t[t.disconnectCalled=0]="disconnectCalled",t[t.unauthorized=1]="unauthorized",t[t.badProtocol=2]="badProtocol",t[t.messageSizeLimit=3]="messageSizeLimit"})(he||(he={}));var Te;(function(t){t[t.subscribeCalled=0]="subscribeCalled",t[t.transportClosed=1]="transportClosed"})(Te||(Te={}));var ve;(function(t){t[t.unsubscribeCalled=0]="unsubscribeCalled",t[t.unauthorized=1]="unauthorized",t[t.clientClosed=2]="clientClosed"})(ve||(ve={}));var R;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected"})(R||(R={}));var O;(function(t){t.Unsubscribed="unsubscribed",t.Subscribing="subscribing",t.Subscribed="subscribed"})(O||(O={}));function Qs(t,e){return t.lastIndexOf(e,0)===0}function nn(t){return t==null?!1:typeof t=="function"}function Ys(t,e){if(globalThis.console){const n=globalThis.console[t];nn(n)&&n.apply(globalThis.console,e)}}function er(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function Re(t,e,n){t>31&&(t=31);const s=er(0,Math.min(n,e*Math.pow(2,t)));return Math.min(n,e+s)}function tr(t){return"error"in t&&t.error!==null}function Ce(t){return Math.min(t*1e3,2147483647)}class nr extends tn{constructor(e,n,s){super(),this._resubscribeTimeout=null,this._refreshTimeout=null,this.channel=n,this.state=O.Unsubscribed,this._centrifuge=e,this._token="",this._getToken=null,this._data=null,this._getData=null,this._recover=!1,this._offset=null,this._epoch=null,this._recoverable=!1,this._positioned=!1,this._joinLeave=!1,this._minResubscribeDelay=500,this._maxResubscribeDelay=2e4,this._resubscribeTimeout=null,this._resubscribeAttempts=0,this._promises={},this._promiseId=0,this._inflight=!1,this._refreshTimeout=null,this._delta="",this._delta_negotiated=!1,this._prevValue=null,this._unsubPromise=Promise.resolve(),this._setOptions(s),this._centrifuge._debugEnabled?(this.on("state",r=>{this._debug("subscription state",n,r.oldState,"->",r.newState)}),this.on("error",r=>{this._debug("subscription error",n,r)})):this.on("error",function(){Function.prototype()})}ready(e){return this.state===O.Unsubscribed?Promise.reject({code:E.subscriptionUnsubscribed,message:this.state}):this.state===O.Subscribed?Promise.resolve():new Promise((n,s)=>{const r={resolve:n,reject:s};e&&(r.timeout=setTimeout(function(){s({code:E.timeout,message:"timeout"})},e)),this._promises[this._nextPromiseId()]=r})}subscribe(){this._isSubscribed()||(this._resubscribeAttempts=0,this._setSubscribing(Te.subscribeCalled,"subscribe called"))}unsubscribe(){this._unsubPromise=this._setUnsubscribed(ve.unsubscribeCalled,"unsubscribe called",!0)}publish(e){const n=this;return this._methodCall().then(function(){return n._centrifuge.publish(n.channel,e)})}presence(){const e=this;return this._methodCall().then(function(){return e._centrifuge.presence(e.channel)})}presenceStats(){const e=this;return this._methodCall().then(function(){return e._centrifuge.presenceStats(e.channel)})}history(e){const n=this;return this._methodCall().then(function(){return n._centrifuge.history(n.channel,e)})}_methodCall(){return this._isSubscribed()?Promise.resolve():this._isUnsubscribed()?Promise.reject({code:E.subscriptionUnsubscribed,message:this.state}):new Promise((e,n)=>{const s=setTimeout(function(){n({code:E.timeout,message:"timeout"})},this._centrifuge._config.timeout);this._promises[this._nextPromiseId()]={timeout:s,resolve:e,reject:n}})}_nextPromiseId(){return++this._promiseId}_needRecover(){return this._recover===!0}_isUnsubscribed(){return this.state===O.Unsubscribed}_isSubscribing(){return this.state===O.Subscribing}_isSubscribed(){return this.state===O.Subscribed}_setState(e){if(this.state!==e){const n=this.state;return this.state=e,this.emit("state",{newState:e,oldState:n,channel:this.channel}),!0}return!1}_usesToken(){return this._token!==""||this._getToken!==null}_clearSubscribingState(){this._resubscribeAttempts=0,this._clearResubscribeTimeout()}_clearSubscribedState(){this._clearRefreshTimeout()}_setSubscribed(e){if(!this._isSubscribing())return;this._clearSubscribingState(),e.recoverable&&(this._recover=!0,this._offset=e.offset||0,this._epoch=e.epoch||""),e.delta?this._delta_negotiated=!0:this._delta_negotiated=!1,this._setState(O.Subscribed);const n=this._centrifuge._getSubscribeContext(this.channel,e);this.emit("subscribed",n),this._resolvePromises();const s=e.publications;if(s&&s.length>0)for(const r in s)s.hasOwnProperty(r)&&this._handlePublication(s[r]);e.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),Ce(e.ttl)))}_setSubscribing(e,n){return le(this,void 0,void 0,function*(){this._isSubscribing()||(this._isSubscribed()&&this._clearSubscribedState(),this._setState(O.Subscribing)&&this.emit("subscribing",{channel:this.channel,code:e,reason:n}),this._centrifuge._transport&&this._centrifuge._transport.emulation()&&(yield this._unsubPromise),this._isSubscribing()&&this._subscribe())})}_subscribe(){return this._debug("subscribing on",this.channel),this._isTransportOpen()?this._inflight?null:(this._inflight=!0,this._canSubscribeWithoutGettingToken()?this._subscribeWithoutToken():(this._getSubscriptionToken().then(e=>this._handleTokenResponse(e)).catch(e=>this._handleTokenError(e)),null)):(this._debug("delay subscribe on",this.channel,"till connected"),null)}_isTransportOpen(){return this._centrifuge._transportIsOpen}_canSubscribeWithoutGettingToken(){return!this._usesToken()||!!this._token}_subscribeWithoutToken(){return this._getData?(this._getDataAndSubscribe(this._token),null):this._sendSubscribe(this._token)}_getDataAndSubscribe(e){if(!this._getData){this._inflight=!1;return}this._getData({channel:this.channel}).then(n=>{if(!this._isSubscribing()){this._inflight=!1;return}this._data=n,this._sendSubscribe(e)}).catch(n=>this._handleGetDataError(n))}_handleGetDataError(e){if(!this._isSubscribing()){this._inflight=!1;return}if(e instanceof F){this._inflight=!1,this._failUnauthorized();return}this.emit("error",{type:"subscribeData",channel:this.channel,error:{code:E.badConfiguration,message:(e==null?void 0:e.toString())||""}}),this._inflight=!1,this._scheduleResubscribe()}_handleTokenResponse(e){if(!this._isSubscribing()){this._inflight=!1;return}if(!e){this._inflight=!1,this._failUnauthorized();return}this._token=e,this._getData?this._getDataAndSubscribe(e):this._sendSubscribe(e)}_handleTokenError(e){if(!this._isSubscribing()){this._inflight=!1;return}if(e instanceof F){this._inflight=!1,this._failUnauthorized();return}this.emit("error",{type:"subscribeToken",channel:this.channel,error:{code:E.subscriptionSubscribeToken,message:(e==null?void 0:e.toString())||""}}),this._inflight=!1,this._scheduleResubscribe()}_sendSubscribe(e){if(!this._isTransportOpen())return this._inflight=!1,null;const n=this._buildSubscribeCommand(e);return this._centrifuge._call(n).then(s=>{this._inflight=!1;const r=s.reply.subscribe;this._handleSubscribeResponse(r),s.next&&s.next()},s=>{this._inflight=!1,this._handleSubscribeError(s.error),s.next&&s.next()}),n}_buildSubscribeCommand(e){const n={channel:this.channel};if(e&&(n.token=e),this._data&&(n.data=this._data),this._positioned&&(n.positioned=!0),this._recoverable&&(n.recoverable=!0),this._joinLeave&&(n.join_leave=!0),this._needRecover()){n.recover=!0;const s=this._getOffset();s&&(n.offset=s);const r=this._getEpoch();r&&(n.epoch=r)}return this._delta&&(n.delta=this._delta),{subscribe:n}}_debug(...e){this._centrifuge._debug(...e)}_handleSubscribeError(e){if(this._isSubscribing()){if(e.code===E.timeout){this._centrifuge._disconnect(z.subscribeTimeout,"subscribe timeout",!0);return}this._subscribeError(e)}}_handleSubscribeResponse(e){this._isSubscribing()&&this._setSubscribed(e)}_setUnsubscribed(e,n,s){if(this._isUnsubscribed())return Promise.resolve();let r=Promise.resolve();return this._isSubscribed()?(s&&(r=this._centrifuge._unsubscribe(this)),this._clearSubscribedState()):this._isSubscribing()&&(this._inflight&&s&&(r=this._centrifuge._unsubscribe(this)),this._clearSubscribingState()),this._inflight=!1,this._setState(O.Unsubscribed)&&this.emit("unsubscribed",{channel:this.channel,code:e,reason:n}),this._rejectPromises({code:E.subscriptionUnsubscribed,message:this.state}),r}_handlePublication(e){if(this._delta&&this._delta_negotiated){const{newData:s,newPrevValue:r}=this._centrifuge._codec.applyDeltaIfNeeded(e,this._prevValue);e.data=s,this._prevValue=r}const n=this._centrifuge._getPublicationContext(this.channel,e);this.emit("publication",n),e.offset&&(this._offset=e.offset)}_handleJoin(e){const n=this._centrifuge._getJoinLeaveContext(e.info);this.emit("join",{channel:this.channel,info:n})}_handleLeave(e){const n=this._centrifuge._getJoinLeaveContext(e.info);this.emit("leave",{channel:this.channel,info:n})}_resolvePromises(){for(const e in this._promises)this._promises.hasOwnProperty(e)&&(this._promises[e].timeout&&clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e])}_rejectPromises(e){for(const n in this._promises)this._promises.hasOwnProperty(n)&&(this._promises[n].timeout&&clearTimeout(this._promises[n].timeout),this._promises[n].reject(e),delete this._promises[n])}_scheduleResubscribe(){if(!this._isSubscribing()){this._debug("not in subscribing state, skip resubscribe scheduling",this.channel);return}const e=this,n=this._getResubscribeDelay();this._resubscribeTimeout=setTimeout(function(){e._isSubscribing()&&e._subscribe()},n),this._debug("resubscribe scheduled after "+n,this.channel)}_subscribeError(e){if(this._isSubscribing())if(e.code<100||e.code===109||e.temporary===!0){e.code===109&&(this._token="");const n={channel:this.channel,type:"subscribe",error:e};this._centrifuge.state===R.Connected&&this.emit("error",n),this._scheduleResubscribe()}else this._setUnsubscribed(e.code,e.message,!1)}_getResubscribeDelay(){const e=Re(this._resubscribeAttempts,this._minResubscribeDelay,this._maxResubscribeDelay);return this._resubscribeAttempts++,e}_setOptions(e){if(e&&(e.since&&(this._offset=e.since.offset,this._epoch=e.since.epoch,this._recover=!0),e.data&&(this._data=e.data),e.getData&&(this._getData=e.getData),e.minResubscribeDelay!==void 0&&(this._minResubscribeDelay=e.minResubscribeDelay),e.maxResubscribeDelay!==void 0&&(this._maxResubscribeDelay=e.maxResubscribeDelay),e.token&&(this._token=e.token),e.getToken&&(this._getToken=e.getToken),e.positioned===!0&&(this._positioned=!0),e.recoverable===!0&&(this._recoverable=!0),e.joinLeave===!0&&(this._joinLeave=!0),e.delta)){if(e.delta!=="fossil")throw new Error("unsupported delta format");this._delta=e.delta}}_getOffset(){const e=this._offset;return e!==null?e:0}_getEpoch(){const e=this._epoch;return e!==null?e:""}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearResubscribeTimeout(){this._resubscribeTimeout!==null&&(clearTimeout(this._resubscribeTimeout),this._resubscribeTimeout=null)}_getSubscriptionToken(){this._debug("get subscription token for channel",this.channel);const e={channel:this.channel},n=this._getToken;if(n===null)throw this.emit("error",{type:"configuration",channel:this.channel,error:{code:E.badConfiguration,message:"provide a function to get channel subscription token"}}),new F("");return n(e)}_refresh(){this._clearRefreshTimeout();const e=this;this._getSubscriptionToken().then(function(n){if(!e._isSubscribed())return;if(!n){e._failUnauthorized();return}e._token=n;const r={sub_refresh:{channel:e.channel,token:n}};e._centrifuge._call(r).then(i=>{const o=i.reply.sub_refresh;e._refreshResponse(o),i.next&&i.next()},i=>{e._refreshError(i.error),i.next&&i.next()})}).catch(function(n){if(n instanceof F){e._failUnauthorized();return}e.emit("error",{type:"refreshToken",channel:e.channel,error:{code:E.subscriptionRefreshToken,message:n!==void 0?n.toString():""}}),e._refreshTimeout=setTimeout(()=>e._refresh(),e._getRefreshRetryDelay())})}_refreshResponse(e){this._isSubscribed()&&(this._debug("subscription token refreshed, channel",this.channel),this._clearRefreshTimeout(),e.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),Ce(e.ttl))))}_refreshError(e){this._isSubscribed()&&(e.code<100||e.temporary===!0?(this.emit("error",{type:"refresh",channel:this.channel,error:e}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._setUnsubscribed(e.code,e.message,!0))}_getRefreshRetryDelay(){return Re(0,1e4,2e4)}_failUnauthorized(){this._setUnsubscribed(ve.unauthorized,"unauthorized",!0)}}class sr{constructor(e,n){this.endpoint=e,this.options=n,this._transport=null}name(){return"sockjs"}subName(){return"sockjs-"+this._transport.transport}emulation(){return!1}supported(){return this.options.sockjs!==null}initialize(e,n){this._transport=new this.options.sockjs(this.endpoint,null,this.options.sockjsOptions),this._transport.onopen=()=>{n.onOpen()},this._transport.onerror=s=>{n.onError(s)},this._transport.onclose=s=>{n.onClose(s)},this._transport.onmessage=s=>{n.onMessage(s.data)}}close(){this._transport.close()}send(e){this._transport.send(e)}}class wt{constructor(e,n){this.endpoint=e,this.options=n,this._transport=null}name(){return"websocket"}subName(){return"websocket"}emulation(){return!1}supported(){return this.options.websocket!==void 0&&this.options.websocket!==null}initialize(e,n){let s="";e==="protobuf"&&(s="centrifuge-protobuf"),s!==""?this._transport=new this.options.websocket(this.endpoint,s):this._transport=new this.options.websocket(this.endpoint),e==="protobuf"&&(this._transport.binaryType="arraybuffer"),this._transport.onopen=()=>{n.onOpen()},this._transport.onerror=r=>{n.onError(r)},this._transport.onclose=r=>{n.onClose(r)},this._transport.onmessage=r=>{n.onMessage(r.data)}}close(){this._transport.close()}send(e){this._transport.send(e)}}class rr{constructor(e,n){this.endpoint=e,this.options=n,this._abortController=null,this._utf8decoder=new TextDecoder,this._protocol="json"}name(){return"http_stream"}subName(){return"http_stream"}emulation(){return!0}_handleErrors(e){if(!e.ok)throw new Error(e.status);return e}_fetchEventTarget(e,n,s){const r=new EventTarget,i=e.options.fetch;return i(n,s).then(e._handleErrors).then(o=>{r.dispatchEvent(new Event("open"));let a="",u=0,l=new Uint8Array;const h=o.body.getReader();return new e.options.readableStream({start(d){function g(){return h.read().then(({done:b,value:p})=>{if(b){r.dispatchEvent(new Event("close")),d.close();return}try{if(e._protocol==="json")for(a+=e._utf8decoder.decode(p);u<a.length;)if(a[u]===`
`){const m=a.substring(0,u);r.dispatchEvent(new MessageEvent("message",{data:m})),a=a.substring(u+1),u=0}else++u;else{const m=new Uint8Array(l.length+p.length);for(m.set(l),m.set(p,l.length),l=m;;){const f=e.options.decoder.decodeReply(l);if(f.ok){const S=l.slice(0,f.pos);r.dispatchEvent(new MessageEvent("message",{data:S})),l=l.slice(f.pos);continue}break}}}catch(m){r.dispatchEvent(new Event("error",{detail:m})),r.dispatchEvent(new Event("close")),d.close();return}g()}).catch(function(b){r.dispatchEvent(new Event("error",{detail:b})),r.dispatchEvent(new Event("close")),d.close()})}return g()}})}).catch(o=>{r.dispatchEvent(new Event("error",{detail:o})),r.dispatchEvent(new Event("close"))}),r}supported(){return this.options.fetch!==null&&this.options.readableStream!==null&&typeof TextDecoder<"u"&&typeof AbortController<"u"&&typeof EventTarget<"u"&&typeof Event<"u"&&typeof MessageEvent<"u"&&typeof Error<"u"}initialize(e,n,s){this._protocol=e,this._abortController=new AbortController;let r,i;e==="json"?(r={Accept:"application/json","Content-Type":"application/json"},i=s):(r={Accept:"application/octet-stream","Content-Type":"application/octet-stream"},i=s);const o={method:"POST",headers:r,body:i,mode:"cors",credentials:"same-origin",signal:this._abortController.signal},a=this._fetchEventTarget(this,this.endpoint,o);a.addEventListener("open",()=>{n.onOpen()}),a.addEventListener("error",u=>{this._abortController.abort(),n.onError(u)}),a.addEventListener("close",()=>{this._abortController.abort(),n.onClose({code:4,reason:"connection closed"})}),a.addEventListener("message",u=>{n.onMessage(u.data)})}close(){this._abortController.abort()}send(e,n,s){let r,i;const o={session:n,node:s,data:e};this._protocol==="json"?(r={"Content-Type":"application/json"},i=JSON.stringify(o)):(r={"Content-Type":"application/octet-stream"},i=this.options.encoder.encodeEmulationRequest(o));const a=this.options.fetch,u={method:"POST",headers:r,body:i,mode:"cors",credentials:"same-origin"};a(this.options.emulationEndpoint,u)}}class ir{constructor(e,n){this.endpoint=e,this.options=n,this._protocol="json",this._transport=null,this._onClose=null}name(){return"sse"}subName(){return"sse"}emulation(){return!0}supported(){return this.options.eventsource!==null&&this.options.fetch!==null}initialize(e,n,s){let r;globalThis&&globalThis.document&&globalThis.document.baseURI?r=new URL(this.endpoint,globalThis.document.baseURI):r=new URL(this.endpoint),r.searchParams.append("cf_connect",s);const i={},o=new this.options.eventsource(r.toString(),i);this._transport=o;const a=this;o.onopen=function(){n.onOpen()},o.onerror=function(u){o.close(),n.onError(u),n.onClose({code:4,reason:"connection closed"})},o.onmessage=function(u){n.onMessage(u.data)},a._onClose=function(){n.onClose({code:4,reason:"connection closed"})}}close(){this._transport.close(),this._onClose!==null&&this._onClose()}send(e,n,s){const r={session:n,node:s,data:e},i={"Content-Type":"application/json"},o=JSON.stringify(r),a=this.options.fetch,u={method:"POST",headers:i,body:o,mode:"cors",credentials:"same-origin"};a(this.options.emulationEndpoint,u)}}class or{constructor(e,n){this.endpoint=e,this.options=n,this._transport=null,this._stream=null,this._writer=null,this._utf8decoder=new TextDecoder,this._protocol="json"}name(){return"webtransport"}subName(){return"webtransport"}emulation(){return!1}supported(){return this.options.webtransport!==void 0&&this.options.webtransport!==null}initialize(e,n){return le(this,void 0,void 0,function*(){let s;globalThis&&globalThis.document&&globalThis.document.baseURI?s=new URL(this.endpoint,globalThis.document.baseURI):s=new URL(this.endpoint),e==="protobuf"&&s.searchParams.append("cf_protocol","protobuf"),this._protocol=e;const r=new EventTarget;this._transport=new this.options.webtransport(s.toString()),this._transport.closed.then(()=>{n.onClose({code:4,reason:"connection closed"})}).catch(()=>{n.onClose({code:4,reason:"connection closed"})});try{yield this._transport.ready}catch{this.close();return}let i;try{i=yield this._transport.createBidirectionalStream()}catch{this.close();return}this._stream=i,this._writer=this._stream.writable.getWriter(),r.addEventListener("close",()=>{n.onClose({code:4,reason:"connection closed"})}),r.addEventListener("message",o=>{n.onMessage(o.data)}),this._startReading(r),n.onOpen()})}_startReading(e){return le(this,void 0,void 0,function*(){const n=this._stream.readable.getReader();let s="",r=0,i=new Uint8Array;try{for(;;){const{done:o,value:a}=yield n.read();if(a.length>0)if(this._protocol==="json")for(s+=this._utf8decoder.decode(a);r<s.length;)if(s[r]===`
`){const u=s.substring(0,r);e.dispatchEvent(new MessageEvent("message",{data:u})),s=s.substring(r+1),r=0}else++r;else{const u=new Uint8Array(i.length+a.length);for(u.set(i),u.set(a,i.length),i=u;;){const l=this.options.decoder.decodeReply(i);if(l.ok){const h=i.slice(0,l.pos);e.dispatchEvent(new MessageEvent("message",{data:h})),i=i.slice(l.pos);continue}break}}if(o)break}}catch{e.dispatchEvent(new Event("close"))}})}close(){return le(this,void 0,void 0,function*(){try{this._writer&&(yield this._writer.close()),this._transport.close()}catch{}})}send(e){return le(this,void 0,void 0,function*(){let n;this._protocol==="json"?n=new TextEncoder().encode(e+`
`):n=e;try{yield this._writer.write(n)}catch{this.close()}})}}const ar=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];class cr{constructor(e){this.a=e,this.pos=0}haveBytes(){return this.pos<this.a.length}getByte(){const e=this.a[this.pos];if(this.pos++,this.pos>this.a.length)throw new RangeError("out of bounds");return e}getChar(){return String.fromCharCode(this.getByte())}getInt(){let e=0,n;for(;this.haveBytes()&&(n=ar[127&this.getByte()])>=0;)e=(e<<6)+n;return this.pos--,e>>>0}}class ur{constructor(){this.a=[]}toByteArray(e){return Array.isArray(e)?this.a:new Uint8Array(this.a)}putArray(e,n,s){for(let r=n;r<s;r++)this.a.push(e[r])}}function lr(t){let e=0,n=0,s=0,r=0,i=0,o=t.length;for(;o>=16;)e=e+t[i+0]|0,n=n+t[i+1]|0,s=s+t[i+2]|0,r=r+t[i+3]|0,e=e+t[i+4]|0,n=n+t[i+5]|0,s=s+t[i+6]|0,r=r+t[i+7]|0,e=e+t[i+8]|0,n=n+t[i+9]|0,s=s+t[i+10]|0,r=r+t[i+11]|0,e=e+t[i+12]|0,n=n+t[i+13]|0,s=s+t[i+14]|0,r=r+t[i+15]|0,i+=16,o-=16;for(;o>=4;)e=e+t[i+0]|0,n=n+t[i+1]|0,s=s+t[i+2]|0,r=r+t[i+3]|0,i+=4,o-=4;switch(r=((r+(s<<8)|0)+(n<<16)|0)+(e<<24)|0,o){case 3:r=r+(t[i+2]<<8)|0;case 2:r=r+(t[i+1]<<16)|0;case 1:r=r+(t[i+0]<<24)|0}return r>>>0}function hr(t,e){let n=0;const s=new cr(e),r=t.length,i=e.length,o=s.getInt();if(s.getChar()!==`
`)throw new Error("size integer not terminated by '\\n'");const a=new ur;for(;s.haveBytes();){const u=s.getInt();let l;switch(s.getChar()){case"@":if(l=s.getInt(),s.haveBytes()&&s.getChar()!==",")throw new Error("copy command not terminated by ','");if(n+=u,n>o)throw new Error("copy exceeds output file size");if(l+u>r)throw new Error("copy extends past end of input");a.putArray(t,l,l+u);break;case":":if(n+=u,n>o)throw new Error("insert command gives an output larger than predicted");if(u>i)throw new Error("insert count exceeds size of delta");a.putArray(s.a,s.pos,s.pos+u),s.pos+=u;break;case";":{const h=a.toByteArray(t);if(u!==lr(h))throw new Error("bad checksum");if(n!==o)throw new Error("generated size does not match predicted size");return h}default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")}class St{name(){return"json"}encodeCommands(e){return e.map(n=>JSON.stringify(n)).join(`
`)}decodeReplies(e){return e.trim().split(`
`).map(n=>JSON.parse(n))}applyDeltaIfNeeded(e,n){let s,r;if(e.delta){const i=hr(n,new TextEncoder().encode(e.data));s=JSON.parse(new TextDecoder().decode(i)),r=i}else s=JSON.parse(e.data),r=new TextEncoder().encode(e.data);return{newData:s,newPrevValue:r}}}const fr={headers:{},token:"",getToken:null,data:null,getData:null,debug:!1,name:"js",version:"",fetch:null,readableStream:null,websocket:null,eventsource:null,sockjs:null,sockjsOptions:{},emulationEndpoint:"/emulation",minReconnectDelay:500,maxReconnectDelay:2e4,timeout:5e3,maxServerPingDelay:1e4,networkEventTarget:null};class F extends Error{constructor(e){super(e),this.name=this.constructor.name}}class Ne extends tn{constructor(e,n){super(),this._reconnectTimeout=null,this._refreshTimeout=null,this._serverPingTimeout=null,this.state=R.Disconnected,this._transportIsOpen=!1,this._endpoint=e,this._emulation=!1,this._transports=[],this._currentTransportIndex=0,this._triedAllTransports=!1,this._transportWasOpen=!1,this._transport=null,this._transportId=0,this._deviceWentOffline=!1,this._transportClosed=!0,this._codec=new St,this._reconnecting=!1,this._reconnectTimeout=null,this._reconnectAttempts=0,this._client=null,this._session="",this._node="",this._subs={},this._serverSubs={},this._commandId=0,this._commands=[],this._batching=!1,this._refreshRequired=!1,this._refreshTimeout=null,this._callbacks={},this._token="",this._data=null,this._dispatchPromise=Promise.resolve(),this._serverPing=0,this._serverPingTimeout=null,this._sendPong=!1,this._promises={},this._promiseId=0,this._debugEnabled=!1,this._networkEventsSet=!1,this._config=Object.assign(Object.assign({},fr),n),this._configure(),this._debugEnabled?(this.on("state",s=>{this._debug("client state",s.oldState,"->",s.newState)}),this.on("error",s=>{this._debug("client error",s)})):this.on("error",function(){Function.prototype()})}newSubscription(e,n){if(this.getSubscription(e)!==null)throw new Error("Subscription to the channel "+e+" already exists");const s=new nr(this,e,n);return this._subs[e]=s,s}getSubscription(e){return this._getSub(e)}removeSubscription(e){e&&(e.state!==O.Unsubscribed&&e.unsubscribe(),this._removeSubscription(e))}subscriptions(){return this._subs}ready(e){return this.state===R.Disconnected?Promise.reject({code:E.clientDisconnected,message:"client disconnected"}):this.state===R.Connected?Promise.resolve():new Promise((n,s)=>{const r={resolve:n,reject:s};e&&(r.timeout=setTimeout(function(){s({code:E.timeout,message:"timeout"})},e)),this._promises[this._nextPromiseId()]=r})}connect(){if(this._isConnected()){this._debug("connect called when already connected");return}if(this._isConnecting()){this._debug("connect called when already connecting");return}this._debug("connect called"),this._reconnectAttempts=0,this._startConnecting()}disconnect(){this._disconnect(he.disconnectCalled,"disconnect called",!1)}setToken(e){this._token=e}setHeaders(e){this._config.headers=e}send(e){const n={send:{data:e}},s=this;return this._methodCall().then(function(){return s._transportSendCommands([n])?Promise.resolve():Promise.reject(s._createErrorObject(E.transportWriteError,"transport write error"))})}rpc(e,n){const s={rpc:{method:e,data:n}},r=this;return this._methodCall().then(function(){return r._callPromise(s,function(i){return{data:i.rpc.data}})})}publish(e,n){const s={publish:{channel:e,data:n}},r=this;return this._methodCall().then(function(){return r._callPromise(s,function(){return{}})})}history(e,n){const s={history:this._getHistoryRequest(e,n)},r=this;return this._methodCall().then(function(){return r._callPromise(s,function(i){const o=i.history,a=[];if(o.publications)for(let u=0;u<o.publications.length;u++)a.push(r._getPublicationContext(e,o.publications[u]));return{publications:a,epoch:o.epoch||"",offset:o.offset||0}})})}presence(e){const n={presence:{channel:e}},s=this;return this._methodCall().then(function(){return s._callPromise(n,function(r){const i=r.presence.presence;for(const o in i)if(i.hasOwnProperty(o)){const a=i[o].conn_info,u=i[o].chan_info;a&&(i[o].connInfo=a),u&&(i[o].chanInfo=u)}return{clients:i}})})}presenceStats(e){const n={presence_stats:{channel:e}},s=this;return this._methodCall().then(function(){return s._callPromise(n,function(r){const i=r.presence_stats;return{numUsers:i.num_users,numClients:i.num_clients}})})}startBatching(){this._batching=!0}stopBatching(){const e=this;Promise.resolve().then(function(){Promise.resolve().then(function(){e._batching=!1,e._flush()})})}_debug(...e){this._debugEnabled&&Ys("debug",e)}_formatOverride(){}_configure(){if(!("Promise"in globalThis))throw new Error("Promise polyfill required");if(!this._endpoint)throw new Error("endpoint configuration required");if(this._config.token!==null&&(this._token=this._config.token),this._config.data!==null&&(this._data=this._config.data),this._codec=new St,this._formatOverride(),(this._config.debug===!0||typeof localStorage<"u"&&localStorage.getItem("centrifuge.debug"))&&(this._debugEnabled=!0),this._debug("config",this._config),typeof this._endpoint!="string")if(typeof this._endpoint=="object"&&this._endpoint instanceof Array){this._transports=this._endpoint,this._emulation=!0;for(const e in this._transports)if(this._transports.hasOwnProperty(e)){const n=this._transports[e];if(!n.endpoint||!n.transport)throw new Error("malformed transport configuration");const s=n.transport;if(["websocket","http_stream","sse","sockjs","webtransport"].indexOf(s)<0)throw new Error("unsupported transport name: "+s)}}else throw new Error("unsupported url configuration type: only string or array of objects are supported")}_setState(e){if(this.state!==e){this._reconnecting=!1;const n=this.state;return this.state=e,this.emit("state",{newState:e,oldState:n}),!0}return!1}_isDisconnected(){return this.state===R.Disconnected}_isConnecting(){return this.state===R.Connecting}_isConnected(){return this.state===R.Connected}_nextCommandId(){return++this._commandId}_setNetworkEvents(){if(this._networkEventsSet)return;let e=null;this._config.networkEventTarget!==null?e=this._config.networkEventTarget:typeof globalThis.addEventListener<"u"&&(e=globalThis),e&&(e.addEventListener("offline",()=>{this._debug("offline event triggered"),(this.state===R.Connected||this.state===R.Connecting)&&(this._disconnect(z.transportClosed,"transport closed",!0),this._deviceWentOffline=!0)}),e.addEventListener("online",()=>{this._debug("online event triggered"),this.state===R.Connecting&&(this._deviceWentOffline&&!this._transportClosed&&(this._deviceWentOffline=!1,this._transportClosed=!0),this._clearReconnectTimeout(),this._startReconnecting())}),this._networkEventsSet=!0)}_getReconnectDelay(){const e=Re(this._reconnectAttempts,this._config.minReconnectDelay,this._config.maxReconnectDelay);return this._reconnectAttempts+=1,e}_clearOutgoingRequests(){for(const e in this._callbacks)if(this._callbacks.hasOwnProperty(e)){const n=this._callbacks[e];clearTimeout(n.timeout);const s=n.errback;if(!s)continue;s({error:this._createErrorObject(E.connectionClosed,"connection closed")})}this._callbacks={}}_clearConnectedState(){this._client=null,this._clearServerPingTimeout(),this._clearRefreshTimeout();for(const e in this._subs){if(!this._subs.hasOwnProperty(e))continue;const n=this._subs[e];n.state===O.Subscribed&&n._setSubscribing(Te.transportClosed,"transport closed")}for(const e in this._serverSubs)this._serverSubs.hasOwnProperty(e)&&this.emit("subscribing",{channel:e})}_handleWriteError(e){for(const n of e){const s=n.id;if(!(s in this._callbacks))continue;const r=this._callbacks[s];clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s];const i=r.errback;i({error:this._createErrorObject(E.transportWriteError,"transport write error")})}}_transportSendCommands(e){if(!e.length)return!0;if(!this._transport)return!1;try{this._transport.send(this._codec.encodeCommands(e),this._session,this._node)}catch(n){return this._debug("error writing commands",n),this._handleWriteError(e),!1}return!0}_initializeTransport(){let e;this._config.websocket!==null?e=this._config.websocket:typeof globalThis.WebSocket!="function"&&typeof globalThis.WebSocket!="object"||(e=globalThis.WebSocket);let n=null;this._config.sockjs!==null?n=this._config.sockjs:typeof globalThis.SockJS<"u"&&(n=globalThis.SockJS);let s=null;this._config.eventsource!==null?s=this._config.eventsource:typeof globalThis.EventSource<"u"&&(s=globalThis.EventSource);let r=null;this._config.fetch!==null?r=this._config.fetch:typeof globalThis.fetch<"u"&&(r=globalThis.fetch);let i=null;if(this._config.readableStream!==null?i=this._config.readableStream:typeof globalThis.ReadableStream<"u"&&(i=globalThis.ReadableStream),this._emulation){this._currentTransportIndex>=this._transports.length&&(this._triedAllTransports=!0,this._currentTransportIndex=0);let b=0;for(;;){if(b>=this._transports.length)throw new Error("no supported transport found");const p=this._transports[this._currentTransportIndex],m=p.transport,f=p.endpoint;if(m==="websocket"){if(this._debug("trying websocket transport"),this._transport=new wt(f,{websocket:e}),!this._transport.supported()){this._debug("websocket transport not available"),this._currentTransportIndex++,b++;continue}}else if(m==="webtransport"){if(this._debug("trying webtransport transport"),this._transport=new or(f,{webtransport:globalThis.WebTransport,decoder:this._codec,encoder:this._codec}),!this._transport.supported()){this._debug("webtransport transport not available"),this._currentTransportIndex++,b++;continue}}else if(m==="http_stream"){if(this._debug("trying http_stream transport"),this._transport=new rr(f,{fetch:r,readableStream:i,emulationEndpoint:this._config.emulationEndpoint,decoder:this._codec,encoder:this._codec}),!this._transport.supported()){this._debug("http_stream transport not available"),this._currentTransportIndex++,b++;continue}}else if(m==="sse"){if(this._debug("trying sse transport"),this._transport=new ir(f,{eventsource:s,fetch:r,emulationEndpoint:this._config.emulationEndpoint}),!this._transport.supported()){this._debug("sse transport not available"),this._currentTransportIndex++,b++;continue}}else if(m==="sockjs"){if(this._debug("trying sockjs"),this._transport=new sr(f,{sockjs:n,sockjsOptions:this._config.sockjsOptions}),!this._transport.supported()){this._debug("sockjs transport not available"),this._currentTransportIndex++,b++;continue}}else throw new Error("unknown transport "+m);break}}else{if(Qs(this._endpoint,"http"))throw new Error("Provide explicit transport endpoints configuration in case of using HTTP (i.e. using array of TransportEndpoint instead of a single string), or use ws(s):// scheme in an endpoint if you aimed using WebSocket transport");if(this._debug("client will use websocket"),this._transport=new wt(this._endpoint,{websocket:e}),!this._transport.supported())throw new Error("WebSocket constructor not found, make sure it is available globally or passed as a dependency in Centrifuge options")}const o=this,a=this._transport,u=this._nextTransportId();o._debug("id of transport",u);let l=!1;const h=[];if(this._transport.emulation()){const b=o._sendConnect(!0);h.push(b)}this._setNetworkEvents();const d=this._codec.encodeCommands(h);this._transportClosed=!1;let g;g=setTimeout(function(){a.close()},this._config.timeout),this._transport.initialize(this._codec.name(),{onOpen:function(){if(g&&(clearTimeout(g),g=null),o._transportId!=u){o._debug("open callback from non-actual transport"),a.close();return}l=!0,o._debug(a.subName(),"transport open"),!a.emulation()&&(o._transportIsOpen=!0,o._transportWasOpen=!0,o.startBatching(),o._sendConnect(!1),o._sendSubscribeCommands(),o.stopBatching(),o.emit("__centrifuge_debug:connect_frame_sent",{}))},onError:function(b){if(o._transportId!=u){o._debug("error callback from non-actual transport");return}o._debug("transport level error",b)},onClose:function(b){if(g&&(clearTimeout(g),g=null),o._transportId!=u){o._debug("close callback from non-actual transport");return}o._debug(a.subName(),"transport closed"),o._transportClosed=!0,o._transportIsOpen=!1;let p="connection closed",m=!0,f=0;if(b&&"code"in b&&b.code&&(f=b.code),b&&b.reason)try{const S=JSON.parse(b.reason);p=S.reason,m=S.reconnect}catch{p=b.reason,(f>=3500&&f<4e3||f>=4500&&f<5e3)&&(m=!1)}f<3e3?(f===1009?(f=he.messageSizeLimit,p="message size limit exceeded",m=!1):(f=z.transportClosed,p="transport closed"),o._emulation&&!o._transportWasOpen&&(o._currentTransportIndex++,o._currentTransportIndex>=o._transports.length&&(o._triedAllTransports=!0,o._currentTransportIndex=0))):o._transportWasOpen=!0,o._isConnecting()&&!l&&o.emit("error",{type:"transport",error:{code:E.transportClosed,message:"transport closed"},transport:a.name()}),o._reconnecting=!1,o._disconnect(f,p,m)},onMessage:function(b){o._dataReceived(b)}},d),o.emit("__centrifuge_debug:transport_initialized",{})}_sendConnect(e){const n=this._constructConnectCommand(),s=this;return this._call(n,e).then(r=>{const i=r.reply.connect;s._connectResponse(i),r.next&&r.next()},r=>{s._connectError(r.error),r.next&&r.next()}),n}_startReconnecting(){if(this._debug("start reconnecting"),!this._isConnecting()){this._debug("stop reconnecting: client not in connecting state");return}if(this._reconnecting){this._debug("reconnect already in progress, return from reconnect routine");return}if(this._transportClosed===!1){this._debug("waiting for transport close");return}this._reconnecting=!0;const e=this._token==="";if(!(this._refreshRequired||e&&this._config.getToken!==null)){this._config.getData?this._config.getData().then(r=>{this._isConnecting()&&(this._data=r,this._initializeTransport())}).catch(r=>this._handleGetDataError(r)):this._initializeTransport();return}const s=this;this._getToken().then(function(r){if(s._isConnecting()){if(r==null||r==null){s._failUnauthorized();return}s._token=r,s._debug("connection token refreshed"),s._config.getData?s._config.getData().then(function(i){s._isConnecting()&&(s._data=i,s._initializeTransport())}).catch(i=>s._handleGetDataError(i)):s._initializeTransport()}}).catch(function(r){if(!s._isConnecting())return;if(r instanceof F){s._failUnauthorized();return}s.emit("error",{type:"connectToken",error:{code:E.clientConnectToken,message:r!==void 0?r.toString():""}});const i=s._getReconnectDelay();s._debug("error on getting connection token, reconnect after "+i+" milliseconds",r),s._reconnecting=!1,s._reconnectTimeout=setTimeout(()=>{s._startReconnecting()},i)})}_handleGetDataError(e){if(e instanceof F){this._failUnauthorized();return}this.emit("error",{type:"connectData",error:{code:E.badConfiguration,message:(e==null?void 0:e.toString())||""}});const n=this._getReconnectDelay();this._debug("error on getting connect data, reconnect after "+n+" milliseconds",e),this._reconnecting=!1,this._reconnectTimeout=setTimeout(()=>{this._startReconnecting()},n)}_connectError(e){this.state===R.Connecting&&(e.code===109&&(this._refreshRequired=!0),e.code<100||e.temporary===!0||e.code===109?(this.emit("error",{type:"connect",error:e}),this._debug("closing transport due to connect error"),this._disconnect(e.code,e.message,!0)):this._disconnect(e.code,e.message,!1))}_scheduleReconnect(){if(!this._isConnecting())return;let e=!1;this._emulation&&!this._transportWasOpen&&!this._triedAllTransports&&(e=!0);let n=this._getReconnectDelay();e&&(n=0),this._debug("reconnect after "+n+" milliseconds"),this._clearReconnectTimeout(),this._reconnectTimeout=setTimeout(()=>{this._startReconnecting()},n)}_constructConnectCommand(){const e={};this._token&&(e.token=this._token),this._data&&(e.data=this._data),this._config.name&&(e.name=this._config.name),this._config.version&&(e.version=this._config.version),Object.keys(this._config.headers).length>0&&(e.headers=this._config.headers);const n={};let s=!1;for(const r in this._serverSubs)if(this._serverSubs.hasOwnProperty(r)&&this._serverSubs[r].recoverable){s=!0;const i={recover:!0};this._serverSubs[r].offset&&(i.offset=this._serverSubs[r].offset),this._serverSubs[r].epoch&&(i.epoch=this._serverSubs[r].epoch),n[r]=i}return s&&(e.subs=n),{connect:e}}_getHistoryRequest(e,n){const s={channel:e};return n!==void 0&&(n.since&&(s.since={offset:n.since.offset},n.since.epoch&&(s.since.epoch=n.since.epoch)),n.limit!==void 0&&(s.limit=n.limit),n.reverse===!0&&(s.reverse=!0)),s}_methodCall(){return this._isConnected()?Promise.resolve():new Promise((e,n)=>{const s=setTimeout(function(){n({code:E.timeout,message:"timeout"})},this._config.timeout);this._promises[this._nextPromiseId()]={timeout:s,resolve:e,reject:n}})}_callPromise(e,n){return new Promise((s,r)=>{this._call(e,!1).then(i=>{s(n(i.reply)),i.next&&i.next()},i=>{r(i.error),i.next&&i.next()})})}_dataReceived(e){this._serverPing>0&&this._waitServerPing();const n=this._codec.decodeReplies(e);this._dispatchPromise=this._dispatchPromise.then(()=>{let s;this._dispatchPromise=new Promise(r=>{s=r}),this._dispatchSynchronized(n,s)})}_dispatchSynchronized(e,n){let s=Promise.resolve();for(const r in e)e.hasOwnProperty(r)&&(s=s.then(()=>this._dispatchReply(e[r])));s=s.then(()=>{n()})}_dispatchReply(e){let n;const s=new Promise(i=>{n=i});if(e==null)return this._debug("dispatch: got undefined or null reply"),n(),s;const r=e.id;return r&&r>0?this._handleReply(e,n):e.push?this._handlePush(e.push,n):this._handleServerPing(n),s}_call(e,n){return new Promise((s,r)=>{e.id=this._nextCommandId(),this._registerCall(e.id,s,r),n||this._addCommand(e)})}_startConnecting(){this._debug("start connecting"),this._setState(R.Connecting)&&this.emit("connecting",{code:z.connectCalled,reason:"connect called"}),this._client=null,this._startReconnecting()}_disconnect(e,n,s){if(this._isDisconnected())return;this._transportIsOpen=!1;const r=this.state;this._reconnecting=!1;const i={code:e,reason:n};let o=!1;if(s?o=this._setState(R.Connecting):(o=this._setState(R.Disconnected),this._rejectPromises({code:E.clientDisconnected,message:"disconnected"})),this._clearOutgoingRequests(),r===R.Connecting&&this._clearReconnectTimeout(),r===R.Connected&&this._clearConnectedState(),o&&(this._isConnecting()?this.emit("connecting",i):this.emit("disconnected",i)),this._transport){this._debug("closing existing transport");const a=this._transport;this._transport=null,a.close(),this._transportClosed=!0,this._nextTransportId()}else this._debug("no transport to close");this._scheduleReconnect()}_failUnauthorized(){this._disconnect(he.unauthorized,"unauthorized",!1)}_getToken(){if(this._debug("get connection token"),!this._config.getToken)throw this.emit("error",{type:"configuration",error:{code:E.badConfiguration,message:"token expired but no getToken function set in the configuration"}}),new F("");return this._config.getToken({})}_refresh(){const e=this._client,n=this;this._getToken().then(function(s){if(e!==n._client)return;if(!s){n._failUnauthorized();return}if(n._token=s,n._debug("connection token refreshed"),!n._isConnected())return;const r={refresh:{token:n._token}};n._call(r,!1).then(i=>{const o=i.reply.refresh;n._refreshResponse(o),i.next&&i.next()},i=>{n._refreshError(i.error),i.next&&i.next()})}).catch(function(s){if(n._isConnected()){if(s instanceof F){n._failUnauthorized();return}n.emit("error",{type:"refreshToken",error:{code:E.clientRefreshToken,message:s!==void 0?s.toString():""}}),n._refreshTimeout=setTimeout(()=>n._refresh(),n._getRefreshRetryDelay())}})}_refreshError(e){e.code<100||e.temporary===!0?(this.emit("error",{type:"refresh",error:e}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._disconnect(e.code,e.message,!1)}_getRefreshRetryDelay(){return Re(0,5e3,1e4)}_refreshResponse(e){this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),e.expires&&(this._client=e.client,this._refreshTimeout=setTimeout(()=>this._refresh(),Ce(e.ttl)))}_removeSubscription(e){e!==null&&delete this._subs[e.channel]}_unsubscribe(e){if(!this._transportIsOpen)return Promise.resolve();const s={unsubscribe:{channel:e.channel}},r=this;return new Promise((o,a)=>{this._call(s,!1).then(u=>{o(),u.next&&u.next()},u=>{o(),u.next&&u.next(),r._disconnect(z.unsubscribeError,"unsubscribe error",!0)})})}_getSub(e){const n=this._subs[e];return n||null}_isServerSub(e){return this._serverSubs[e]!==void 0}_sendSubscribeCommands(){const e=[];for(const n in this._subs){if(!this._subs.hasOwnProperty(n))continue;const s=this._subs[n];if(s._inflight!==!0&&s.state===O.Subscribing){const r=s._subscribe();r&&e.push(r)}}return e}_connectResponse(e){if(this._transportIsOpen=!0,this._transportWasOpen=!0,this._reconnectAttempts=0,this._refreshRequired=!1,this._isConnected())return;this._client=e.client,this._setState(R.Connected),this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires&&(this._refreshTimeout=setTimeout(()=>this._refresh(),Ce(e.ttl))),this._session=e.session,this._node=e.node,this.startBatching(),this._sendSubscribeCommands(),this.stopBatching();const n={client:e.client,transport:this._transport.subName()};e.data&&(n.data=e.data),this.emit("connected",n),this._resolvePromises(),this._processServerSubs(e.subs||{}),e.ping&&e.ping>0?(this._serverPing=e.ping*1e3,this._sendPong=e.pong===!0,this._waitServerPing()):this._serverPing=0}_processServerSubs(e){for(const n in e){if(!e.hasOwnProperty(n))continue;const s=e[n];this._serverSubs[n]={offset:s.offset,epoch:s.epoch,recoverable:s.recoverable||!1};const r=this._getSubscribeContext(n,s);this.emit("subscribed",r)}for(const n in e){if(!e.hasOwnProperty(n))continue;const s=e[n];if(s.recovered){const r=s.publications;if(r&&r.length>0)for(const i in r)r.hasOwnProperty(i)&&this._handlePublication(n,r[i])}}for(const n in this._serverSubs)this._serverSubs.hasOwnProperty(n)&&(e[n]||(this.emit("unsubscribed",{channel:n}),delete this._serverSubs[n]))}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearReconnectTimeout(){this._reconnectTimeout!==null&&(clearTimeout(this._reconnectTimeout),this._reconnectTimeout=null)}_clearServerPingTimeout(){this._serverPingTimeout!==null&&(clearTimeout(this._serverPingTimeout),this._serverPingTimeout=null)}_waitServerPing(){this._config.maxServerPingDelay!==0&&this._isConnected()&&(this._clearServerPingTimeout(),this._serverPingTimeout=setTimeout(()=>{this._isConnected()&&this._disconnect(z.noPing,"no ping",!0)},this._serverPing+this._config.maxServerPingDelay))}_getSubscribeContext(e,n){const s={channel:e,positioned:!1,recoverable:!1,wasRecovering:!1,recovered:!1};n.recovered&&(s.recovered=!0),n.positioned&&(s.positioned=!0),n.recoverable&&(s.recoverable=!0),n.was_recovering&&(s.wasRecovering=!0);let r="";"epoch"in n&&(r=n.epoch);let i=0;return"offset"in n&&(i=n.offset),(s.positioned||s.recoverable)&&(s.streamPosition={offset:i,epoch:r}),n.data&&(s.data=n.data),s}_handleReply(e,n){const s=e.id;if(!(s in this._callbacks)){n();return}const r=this._callbacks[s];if(clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s],tr(e)){const i=r.errback;if(!i){n();return}const o=e.error;i({error:o,next:n})}else{const i=r.callback;if(!i)return;i({reply:e,next:n})}}_handleJoin(e,n){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const r={channel:e,info:this._getJoinLeaveContext(n.info)};this.emit("join",r)}return}s._handleJoin(n)}_handleLeave(e,n){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const r={channel:e,info:this._getJoinLeaveContext(n.info)};this.emit("leave",r)}return}s._handleLeave(n)}_handleUnsubscribe(e,n){const s=this._getSub(e);if(!s){this._isServerSub(e)&&(delete this._serverSubs[e],this.emit("unsubscribed",{channel:e}));return}n.code<2500?s._setUnsubscribed(n.code,n.reason,!1):s._setSubscribing(n.code,n.reason)}_handleSubscribe(e,n){this._serverSubs[e]={offset:n.offset,epoch:n.epoch,recoverable:n.recoverable||!1},this.emit("subscribed",this._getSubscribeContext(e,n))}_handleDisconnect(e){const n=e.code;let s=!0;(n>=3500&&n<4e3||n>=4500&&n<5e3)&&(s=!1),this._disconnect(n,e.reason,s)}_getPublicationContext(e,n){const s={channel:e,data:n.data};return n.offset&&(s.offset=n.offset),n.info&&(s.info=this._getJoinLeaveContext(n.info)),n.tags&&(s.tags=n.tags),s}_getJoinLeaveContext(e){const n={client:e.client,user:e.user};return e.conn_info&&(n.connInfo=e.conn_info),e.chan_info&&(n.chanInfo=e.chan_info),n}_handlePublication(e,n){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const r=this._getPublicationContext(e,n);this.emit("publication",r),n.offset!==void 0&&(this._serverSubs[e].offset=n.offset)}return}s._handlePublication(n)}_handleMessage(e){this.emit("message",{data:e.data})}_handleServerPing(e){if(this._sendPong){const n={};this._transportSendCommands([n])}e()}_handlePush(e,n){const s=e.channel;e.pub?this._handlePublication(s,e.pub):e.message?this._handleMessage(e.message):e.join?this._handleJoin(s,e.join):e.leave?this._handleLeave(s,e.leave):e.unsubscribe?this._handleUnsubscribe(s,e.unsubscribe):e.subscribe?this._handleSubscribe(s,e.subscribe):e.disconnect&&this._handleDisconnect(e.disconnect),n()}_flush(){const e=this._commands.slice(0);this._commands=[],this._transportSendCommands(e)}_createErrorObject(e,n,s){const r={code:e,message:n};return s&&(r.temporary=!0),r}_registerCall(e,n,s){this._callbacks[e]={callback:n,errback:s,timeout:null},this._callbacks[e].timeout=setTimeout(()=>{delete this._callbacks[e],nn(s)&&s({error:this._createErrorObject(E.timeout,"timeout")})},this._config.timeout)}_addCommand(e){this._batching?this._commands.push(e):this._transportSendCommands([e])}_nextPromiseId(){return++this._promiseId}_nextTransportId(){return++this._transportId}_resolvePromises(){for(const e in this._promises)this._promises.hasOwnProperty(e)&&(this._promises[e].timeout&&clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e])}_rejectPromises(e){for(const n in this._promises)this._promises.hasOwnProperty(n)&&(this._promises[n].timeout&&clearTimeout(this._promises[n].timeout),this._promises[n].reject(e),delete this._promises[n])}}Ne.SubscriptionState=O;Ne.State=R;Ne.UnauthorizedError=F;const ne=new TextEncoder,Pe=new TextDecoder;function dr(...t){const e=t.reduce((r,{length:i})=>r+i,0),n=new Uint8Array(e);let s=0;for(const r of t)n.set(r,s),s+=r.length;return n}function pr(t){if(Uint8Array.prototype.toBase64)return t.toBase64();const e=32768,n=[];for(let s=0;s<t.length;s+=e)n.push(String.fromCharCode.apply(null,t.subarray(s,s+e)));return btoa(n.join(""))}function mr(t){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(t);const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}function _r(t){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof t=="string"?t:Pe.decode(t),{alphabet:"base64url"});let e=t;e instanceof Uint8Array&&(e=Pe.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return mr(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}function We(t){let e=t;return typeof e=="string"&&(e=ne.encode(e)),Uint8Array.prototype.toBase64?e.toBase64({alphabet:"base64url",omitPadding:!0}):pr(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class Ie extends Error{constructor(n,s){var r;super(n,s);K(this,"code","ERR_JOSE_GENERIC");this.name=this.constructor.name,(r=Error.captureStackTrace)==null||r.call(Error,this,this.constructor)}}K(Ie,"code","ERR_JOSE_GENERIC");class Z extends Ie{constructor(){super(...arguments);K(this,"code","ERR_JOSE_NOT_SUPPORTED")}}K(Z,"code","ERR_JOSE_NOT_SUPPORTED");class ee extends Ie{constructor(){super(...arguments);K(this,"code","ERR_JWS_INVALID")}}K(ee,"code","ERR_JWS_INVALID");class sn extends Ie{constructor(){super(...arguments);K(this,"code","ERR_JWT_INVALID")}}K(sn,"code","ERR_JWT_INVALID");function W(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function ue(t,e){return t.name===e}function Fe(t){return parseInt(t.name.slice(4),10)}function br(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function gr(t,e){if(!t.usages.includes(e))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${e}.`)}function yr(t,e,n){switch(e){case"HS256":case"HS384":case"HS512":{if(!ue(t.algorithm,"HMAC"))throw W("HMAC");const s=parseInt(e.slice(2),10);if(Fe(t.algorithm.hash)!==s)throw W(`SHA-${s}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!ue(t.algorithm,"RSASSA-PKCS1-v1_5"))throw W("RSASSA-PKCS1-v1_5");const s=parseInt(e.slice(2),10);if(Fe(t.algorithm.hash)!==s)throw W(`SHA-${s}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!ue(t.algorithm,"RSA-PSS"))throw W("RSA-PSS");const s=parseInt(e.slice(2),10);if(Fe(t.algorithm.hash)!==s)throw W(`SHA-${s}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!ue(t.algorithm,"Ed25519"))throw W("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!ue(t.algorithm,"ECDSA"))throw W("ECDSA");const s=br(e);if(t.algorithm.namedCurve!==s)throw W(s,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}gr(t,n)}function rn(t,e,...n){var s;if(n=n.filter(Boolean),n.length>2){const r=n.pop();t+=`one of type ${n.join(", ")}, or ${r}.`}else n.length===2?t+=`one of type ${n[0]} or ${n[1]}.`:t+=`of type ${n[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(s=e.constructor)!=null&&s.name&&(t+=` Received an instance of ${e.constructor.name}`),t}const wr=(t,...e)=>rn("Key must be ",t,...e);function on(t,e,...n){return rn(`Key for the ${t} algorithm must be `,e,...n)}function an(t){return(t==null?void 0:t[Symbol.toStringTag])==="CryptoKey"}function cn(t){return(t==null?void 0:t[Symbol.toStringTag])==="KeyObject"}const un=t=>an(t)||cn(t),Sr=(...t)=>{const e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let n;for(const s of e){const r=Object.keys(s);if(!n||n.size===0){n=new Set(r);continue}for(const i of r){if(n.has(i))return!1;n.add(i)}}return!0};function Er(t){return typeof t=="object"&&t!==null}const ln=t=>{if(!Er(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},Tr=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){const{modulusLength:n}=e.algorithm;if(typeof n!="number"||n<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};function vr(t){let e,n;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},n=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},n=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},n=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},n=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},n=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},n=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},n=t.d?["deriveBits"]:[];break;default:throw new Z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"Ed25519":case"EdDSA":e={name:"Ed25519"},n=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},n=t.d?["deriveBits"]:[];break;default:throw new Z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Z('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:n}}const Rr=async t=>{if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:n}=vr(t),s={...t};return delete s.alg,delete s.use,crypto.subtle.importKey("jwk",s,e,t.ext??!t.d,t.key_ops??n)},Cr=(t,e,n,s,r)=>{if(r.crit!==void 0&&(s==null?void 0:s.crit)===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||s.crit===void 0)return new Set;if(!Array.isArray(s.crit)||s.crit.length===0||s.crit.some(o=>typeof o!="string"||o.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;n!==void 0?i=new Map([...Object.entries(n),...e.entries()]):i=e;for(const o of s.crit){if(!i.has(o))throw new Z(`Extension Header Parameter "${o}" is not recognized`);if(r[o]===void 0)throw new t(`Extension Header Parameter "${o}" is missing`);if(i.get(o)&&s[o]===void 0)throw new t(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(s.crit)};function et(t){return ln(t)&&typeof t.kty=="string"}function Pr(t){return t.kty!=="oct"&&typeof t.d=="string"}function Ar(t){return t.kty!=="oct"&&typeof t.d>"u"}function Or(t){return t.kty==="oct"&&typeof t.k=="string"}let re;const Et=async(t,e,n,s=!1)=>{re||(re=new WeakMap);let r=re.get(t);if(r!=null&&r[n])return r[n];const i=await Rr({...e,alg:n});return s&&Object.freeze(t),r?r[n]=i:re.set(t,{[n]:i}),i},xr=(t,e)=>{var o;re||(re=new WeakMap);let n=re.get(t);if(n!=null&&n[e])return n[e];const s=t.type==="public",r=!!s;let i;if(t.asymmetricKeyType==="x25519"){switch(e){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}i=t.toCryptoKey(t.asymmetricKeyType,r,s?[]:["deriveBits"])}if(t.asymmetricKeyType==="ed25519"){if(e!=="EdDSA"&&e!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");i=t.toCryptoKey(t.asymmetricKeyType,r,[s?"verify":"sign"])}if(t.asymmetricKeyType==="rsa"){let a;switch(e){case"RSA-OAEP":a="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":a="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":a="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":a="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(e.startsWith("RSA-OAEP"))return t.toCryptoKey({name:"RSA-OAEP",hash:a},r,s?["encrypt"]:["decrypt"]);i=t.toCryptoKey({name:e.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:a},r,[s?"verify":"sign"])}if(t.asymmetricKeyType==="ec"){const u=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get((o=t.asymmetricKeyDetails)==null?void 0:o.namedCurve);if(!u)throw new TypeError("given KeyObject instance cannot be used for this algorithm");e==="ES256"&&u==="P-256"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:u},r,[s?"verify":"sign"])),e==="ES384"&&u==="P-384"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:u},r,[s?"verify":"sign"])),e==="ES512"&&u==="P-521"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:u},r,[s?"verify":"sign"])),e.startsWith("ECDH-ES")&&(i=t.toCryptoKey({name:"ECDH",namedCurve:u},r,s?[]:["deriveBits"]))}if(!i)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return n?n[e]=i:re.set(t,{[e]:i}),i},kr=async(t,e)=>{if(t instanceof Uint8Array||an(t))return t;if(cn(t)){if(t.type==="secret")return t.export();if("toCryptoKey"in t&&typeof t.toCryptoKey=="function")try{return xr(t,e)}catch(s){if(s instanceof TypeError)throw s}let n=t.export({format:"jwk"});return Et(t,n,e)}if(et(t))return t.k?_r(t.k):Et(t,t,e,!0);throw new Error("unreachable")},te=t=>t==null?void 0:t[Symbol.toStringTag],Ge=(t,e,n)=>{var s,r;if(e.use!==void 0){let i;switch(n){case"sign":case"verify":i="sig";break;case"encrypt":case"decrypt":i="enc";break}if(e.use!==i)throw new TypeError(`Invalid key for this operation, its "use" must be "${i}" when present`)}if(e.alg!==void 0&&e.alg!==t)throw new TypeError(`Invalid key for this operation, its "alg" must be "${t}" when present`);if(Array.isArray(e.key_ops)){let i;switch(!0){case n==="sign":case t==="dir":case t.includes("CBC-HS"):i=n;break;case t.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(t):!t.includes("GCM")&&t.endsWith("KW")?i="unwrapKey":i=n;break;case n==="encrypt":i="wrapKey";break;case n==="decrypt":i=t.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(i&&((r=(s=e.key_ops)==null?void 0:s.includes)==null?void 0:r.call(s,i))===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${i}" when present`)}return!0},Dr=(t,e,n)=>{if(!(e instanceof Uint8Array)){if(et(e)){if(Or(e)&&Ge(t,e,n))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!un(e))throw new TypeError(on(t,e,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(e.type!=="secret")throw new TypeError(`${te(e)} instances for symmetric algorithms must be of type "secret"`)}},Lr=(t,e,n)=>{if(et(e))switch(n){case"decrypt":case"sign":if(Pr(e)&&Ge(t,e,n))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(Ar(e)&&Ge(t,e,n))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!un(e))throw new TypeError(on(t,e,"CryptoKey","KeyObject","JSON Web Key"));if(e.type==="secret")throw new TypeError(`${te(e)} instances for asymmetric algorithms must not be of type "secret"`);if(e.type==="public")switch(n){case"sign":throw new TypeError(`${te(e)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${te(e)} instances for asymmetric algorithm decryption must be of type "private"`)}if(e.type==="private")switch(n){case"verify":throw new TypeError(`${te(e)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${te(e)} instances for asymmetric algorithm encryption must be of type "public"`)}},Ur=(t,e,n)=>{t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(t)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(t)?Dr(t,e,n):Lr(t,e,n)},Nr=(t,e)=>{const n=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:n,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:n,name:"RSA-PSS",saltLength:parseInt(t.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:n,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:n,name:"ECDSA",namedCurve:e.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};default:throw new Z(`alg ${t} is not supported either by JOSE or your javascript runtime`)}},Ir=async(t,e,n)=>{if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(wr(e,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[n])}return yr(e,t,n),e},V=t=>Math.floor(t.getTime()/1e3),hn=60,fn=hn*60,tt=fn*24,jr=tt*7,Br=tt*365.25,Kr=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,He=t=>{const e=Kr.exec(t);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const n=parseFloat(e[2]),s=e[3].toLowerCase();let r;switch(s){case"sec":case"secs":case"second":case"seconds":case"s":r=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":r=Math.round(n*hn);break;case"hour":case"hours":case"hr":case"hrs":case"h":r=Math.round(n*fn);break;case"day":case"days":case"d":r=Math.round(n*tt);break;case"week":case"weeks":case"w":r=Math.round(n*jr);break;default:r=Math.round(n*Br);break}return e[1]==="-"||e[4]==="ago"?-r:r};function G(t,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${t} input`);return e}var T;class Wr{constructor(e){M(this,T);if(!ln(e))throw new TypeError("JWT Claims Set MUST be an object");J(this,T,structuredClone(e))}data(){return ne.encode(JSON.stringify(_(this,T)))}get iss(){return _(this,T).iss}set iss(e){_(this,T).iss=e}get sub(){return _(this,T).sub}set sub(e){_(this,T).sub=e}get aud(){return _(this,T).aud}set aud(e){_(this,T).aud=e}set jti(e){_(this,T).jti=e}set nbf(e){typeof e=="number"?_(this,T).nbf=G("setNotBefore",e):e instanceof Date?_(this,T).nbf=G("setNotBefore",V(e)):_(this,T).nbf=V(new Date)+He(e)}set exp(e){typeof e=="number"?_(this,T).exp=G("setExpirationTime",e):e instanceof Date?_(this,T).exp=G("setExpirationTime",V(e)):_(this,T).exp=V(new Date)+He(e)}set iat(e){typeof e>"u"?_(this,T).iat=V(new Date):e instanceof Date?_(this,T).iat=G("setIssuedAt",V(e)):typeof e=="string"?_(this,T).iat=G("setIssuedAt",V(new Date)+He(e)):_(this,T).iat=G("setIssuedAt",e)}}T=new WeakMap;const Fr=async(t,e,n)=>{const s=await Ir(t,e,"sign");Tr(t,s);const r=await crypto.subtle.sign(Nr(t,s.algorithm),s,n);return new Uint8Array(r)};var de,D,j;class Hr{constructor(e){M(this,de);M(this,D);M(this,j);if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");J(this,de,e)}setProtectedHeader(e){if(_(this,D))throw new TypeError("setProtectedHeader can only be called once");return J(this,D,e),this}setUnprotectedHeader(e){if(_(this,j))throw new TypeError("setUnprotectedHeader can only be called once");return J(this,j,e),this}async sign(e,n){if(!_(this,D)&&!_(this,j))throw new ee("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Sr(_(this,D),_(this,j)))throw new ee("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const s={..._(this,D),..._(this,j)},r=Cr(ee,new Map([["b64",!0]]),n==null?void 0:n.crit,_(this,D),s);let i=!0;if(r.has("b64")&&(i=_(this,D).b64,typeof i!="boolean"))throw new ee('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=s;if(typeof o!="string"||!o)throw new ee('JWS "alg" (Algorithm) Header Parameter missing or invalid');Ur(o,e,"sign");let a=_(this,de);i&&(a=ne.encode(We(a)));let u;_(this,D)?u=ne.encode(We(JSON.stringify(_(this,D)))):u=ne.encode("");const l=dr(u,ne.encode("."),a),h=await kr(e,o),d=await Fr(o,h,l),g={signature:We(d),payload:""};return i&&(g.payload=Pe.decode(a)),_(this,j)&&(g.header=_(this,j)),_(this,D)&&(g.protected=Pe.decode(u)),g}}de=new WeakMap,D=new WeakMap,j=new WeakMap;var ie;class Mr{constructor(e){M(this,ie);J(this,ie,new Hr(e))}setProtectedHeader(e){return _(this,ie).setProtectedHeader(e),this}async sign(e,n){const s=await _(this,ie).sign(e,n);if(s.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${s.protected}.${s.payload}.${s.signature}`}}ie=new WeakMap;var q,U;class Jr{constructor(e={}){M(this,q);M(this,U);J(this,U,new Wr(e))}setIssuer(e){return _(this,U).iss=e,this}setSubject(e){return _(this,U).sub=e,this}setAudience(e){return _(this,U).aud=e,this}setJti(e){return _(this,U).jti=e,this}setNotBefore(e){return _(this,U).nbf=e,this}setExpirationTime(e){return _(this,U).exp=e,this}setIssuedAt(e){return _(this,U).iat=e,this}setProtectedHeader(e){return J(this,q,e),this}async sign(e,n){var r;const s=new Mr(_(this,U).data());if(s.setProtectedHeader(_(this,q)),Array.isArray((r=_(this,q))==null?void 0:r.crit)&&_(this,q).crit.includes("b64")&&_(this,q).b64===!1)throw new sn("JWTs MUST NOT use unencoded payload");return s.sign(e,n)}}q=new WeakMap,U=new WeakMap;document.addEventListener("moonshine:init",async()=>{if(!window.MoonShine){console.error("MoonShine is not initialized");return}let t=localStorage.getItem("token");t===null&&(t=await zr(),localStorage.setItem("token",t));const e=new Ne("ws://localhost:8001/connection/websocket",{token:t});e.on("connected",()=>{document.dispatchEvent(new CustomEvent("moonshine:rush"))}).connect(),window.MoonShine.onCallback("onMoonShineWS",function(n,s){e.newSubscription(n).on("publication",function(i){s(i.data)}).on("subscribing",()=>{document.dispatchEvent(new CustomEvent("rush-subscribe:"))}).subscribe()}),window.MoonShine.onCallback("rushPublish",function(n,s){e.publish(n,s).then().catch(r=>{console.error("Failed to publish message:",r)})})});async function zr(){const t=new TextEncoder().encode("bbe7d157-a253-4094-9759-06a8236543f9");return await new Jr({sub:"42"}).setProtectedHeader({alg:"HS256"}).sign(t)}
