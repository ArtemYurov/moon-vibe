function $e(n,e){return function(){return n.apply(e,arguments)}}const{toString:Ot}=Object.prototype,{getPrototypeOf:ve}=Object,ce=(n=>e=>{const t=Ot.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),A=n=>(n=n.toLowerCase(),e=>ce(e)===n),ae=n=>e=>typeof e===n,{isArray:q}=Array,V=ae("undefined");function Ct(n){return n!==null&&!V(n)&&n.constructor!==null&&!V(n.constructor)&&x(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Ve=A("ArrayBuffer");function kt(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Ve(n.buffer),e}const Pt=ae("string"),x=ae("function"),Ke=ae("number"),ue=n=>n!==null&&typeof n=="object",xt=n=>n===!0||n===!1,Q=n=>{if(ce(n)!=="object")return!1;const e=ve(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},At=A("Date"),Lt=A("File"),Dt=A("Blob"),Nt=A("FileList"),Ut=n=>ue(n)&&x(n.pipe),jt=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||x(n.append)&&((e=ce(n))==="formdata"||e==="object"&&x(n.toString)&&n.toString()==="[object FormData]"))},It=A("URLSearchParams"),[Ft,Bt,zt,Mt]=["ReadableStream","Request","Response","Headers"].map(A),qt=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function K(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let s,r;if(typeof n!="object"&&(n=[n]),q(n))for(s=0,r=n.length;s<r;s++)e.call(null,n[s],s,n);else{const i=t?Object.getOwnPropertyNames(n):Object.keys(n),o=i.length;let c;for(s=0;s<o;s++)c=i[s],e.call(null,n[c],c,n)}}function Ge(n,e){e=e.toLowerCase();const t=Object.keys(n);let s=t.length,r;for(;s-- >0;)if(r=t[s],e===r.toLowerCase())return r;return null}const F=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Xe=n=>!V(n)&&n!==F;function ge(){const{caseless:n}=Xe(this)&&this||{},e={},t=(s,r)=>{const i=n&&Ge(e,r)||r;Q(e[i])&&Q(s)?e[i]=ge(e[i],s):Q(s)?e[i]=ge({},s):q(s)?e[i]=s.slice():e[i]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&K(arguments[s],t);return e}const Wt=(n,e,t,{allOwnKeys:s}={})=>(K(e,(r,i)=>{t&&x(r)?n[i]=$e(r,t):n[i]=r},{allOwnKeys:s}),n),Ht=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Jt=(n,e,t,s)=>{n.prototype=Object.create(e.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},$t=(n,e,t,s)=>{let r,i,o;const c={};if(e=e||{},n==null)return e;do{for(r=Object.getOwnPropertyNames(n),i=r.length;i-- >0;)o=r[i],(!s||s(o,n,e))&&!c[o]&&(e[o]=n[o],c[o]=!0);n=t!==!1&&ve(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},Vt=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const s=n.indexOf(e,t);return s!==-1&&s===t},Kt=n=>{if(!n)return null;if(q(n))return n;let e=n.length;if(!Ke(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},Gt=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&ve(Uint8Array)),Xt=(n,e)=>{const s=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=s.next())&&!r.done;){const i=r.value;e.call(n,i[0],i[1])}},Qt=(n,e)=>{let t;const s=[];for(;(t=n.exec(e))!==null;)s.push(t);return s},Zt=A("HTMLFormElement"),Yt=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,r){return s.toUpperCase()+r}),Pe=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),en=A("RegExp"),Qe=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),s={};K(t,(r,i)=>{let o;(o=e(r,i,n))!==!1&&(s[i]=o||r)}),Object.defineProperties(n,s)},tn=n=>{Qe(n,(e,t)=>{if(x(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=n[t];if(x(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},nn=(n,e)=>{const t={},s=r=>{r.forEach(i=>{t[i]=!0})};return q(n)?s(n):s(String(n).split(e)),t},sn=()=>{},rn=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function on(n){return!!(n&&x(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const cn=n=>{const e=new Array(10),t=(s,r)=>{if(ue(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[r]=s;const i=q(s)?[]:{};return K(s,(o,c)=>{const u=t(o,r+1);!V(u)&&(i[c]=u)}),e[r]=void 0,i}}return s};return t(n,0)},an=A("AsyncFunction"),un=n=>n&&(ue(n)||x(n))&&x(n.then)&&x(n.catch),Ze=((n,e)=>n?setImmediate:e?((t,s)=>(F.addEventListener("message",({source:r,data:i})=>{r===F&&i===t&&s.length&&s.shift()()},!1),r=>{s.push(r),F.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",x(F.postMessage)),ln=typeof queueMicrotask<"u"?queueMicrotask.bind(F):typeof process<"u"&&process.nextTick||Ze,a={isArray:q,isArrayBuffer:Ve,isBuffer:Ct,isFormData:jt,isArrayBufferView:kt,isString:Pt,isNumber:Ke,isBoolean:xt,isObject:ue,isPlainObject:Q,isReadableStream:Ft,isRequest:Bt,isResponse:zt,isHeaders:Mt,isUndefined:V,isDate:At,isFile:Lt,isBlob:Dt,isRegExp:en,isFunction:x,isStream:Ut,isURLSearchParams:It,isTypedArray:Gt,isFileList:Nt,forEach:K,merge:ge,extend:Wt,trim:qt,stripBOM:Ht,inherits:Jt,toFlatObject:$t,kindOf:ce,kindOfTest:A,endsWith:Vt,toArray:Kt,forEachEntry:Xt,matchAll:Qt,isHTMLForm:Zt,hasOwnProperty:Pe,hasOwnProp:Pe,reduceDescriptors:Qe,freezeMethods:tn,toObjectSet:nn,toCamelCase:Yt,noop:sn,toFiniteNumber:rn,findKey:Ge,global:F,isContextDefined:Xe,isSpecCompliantForm:on,toJSONObject:cn,isAsyncFn:an,isThenable:un,setImmediate:Ze,asap:ln};function b(n,e,t,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),r&&(this.response=r,this.status=r.status?r.status:null)}a.inherits(b,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:a.toJSONObject(this.config),code:this.code,status:this.status}}});const Ye=b.prototype,et={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{et[n]={value:n}});Object.defineProperties(b,et);Object.defineProperty(Ye,"isAxiosError",{value:!0});b.from=(n,e,t,s,r,i)=>{const o=Object.create(Ye);return a.toFlatObject(n,o,function(u){return u!==Error.prototype},c=>c!=="isAxiosError"),b.call(o,n.message,e,t,s,r),o.cause=n,o.name=n.name,i&&Object.assign(o,i),o};const hn=null;function ye(n){return a.isPlainObject(n)||a.isArray(n)}function tt(n){return a.endsWith(n,"[]")?n.slice(0,-2):n}function xe(n,e,t){return n?n.concat(e).map(function(r,i){return r=tt(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function fn(n){return a.isArray(n)&&!n.some(ye)}const dn=a.toFlatObject(a,{},null,function(e){return/^is[A-Z]/.test(e)});function le(n,e,t){if(!a.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=a.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,f){return!a.isUndefined(f[_])});const s=t.metaTokens,r=t.visitor||h,i=t.dots,o=t.indexes,u=(t.Blob||typeof Blob<"u"&&Blob)&&a.isSpecCompliantForm(e);if(!a.isFunction(r))throw new TypeError("visitor must be a function");function l(d){if(d===null)return"";if(a.isDate(d))return d.toISOString();if(!u&&a.isBlob(d))throw new b("Blob is not supported. Use a Buffer instead.");return a.isArrayBuffer(d)||a.isTypedArray(d)?u&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function h(d,_,f){let w=d;if(d&&!f&&typeof d=="object"){if(a.endsWith(_,"{}"))_=s?_:_.slice(0,-2),d=JSON.stringify(d);else if(a.isArray(d)&&fn(d)||(a.isFileList(d)||a.endsWith(_,"[]"))&&(w=a.toArray(d)))return _=tt(_),w.forEach(function(R,D){!(a.isUndefined(R)||R===null)&&e.append(o===!0?xe([_],D,i):o===null?_:_+"[]",l(R))}),!1}return ye(d)?!0:(e.append(xe(f,_,i),l(d)),!1)}const p=[],g=Object.assign(dn,{defaultVisitor:h,convertValue:l,isVisitable:ye});function m(d,_){if(!a.isUndefined(d)){if(p.indexOf(d)!==-1)throw Error("Circular reference detected in "+_.join("."));p.push(d),a.forEach(d,function(w,v){(!(a.isUndefined(w)||w===null)&&r.call(e,w,a.isString(v)?v.trim():v,_,g))===!0&&m(w,_?_.concat(v):[v])}),p.pop()}}if(!a.isObject(n))throw new TypeError("data must be an object");return m(n),e}function Ae(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function Re(n,e){this._pairs=[],n&&le(n,this,e)}const nt=Re.prototype;nt.append=function(e,t){this._pairs.push([e,t])};nt.toString=function(e){const t=e?function(s){return e.call(this,s,Ae)}:Ae;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function pn(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function st(n,e,t){if(!e)return n;const s=t&&t.encode||pn;a.isFunction(t)&&(t={serialize:t});const r=t&&t.serialize;let i;if(r?i=r(e,t):i=a.isURLSearchParams(e)?e.toString():new Re(e,t).toString(s),i){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class Le{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){a.forEach(this.handlers,function(s){s!==null&&e(s)})}}const rt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},_n=typeof URLSearchParams<"u"?URLSearchParams:Re,mn=typeof FormData<"u"?FormData:null,bn=typeof Blob<"u"?Blob:null,gn={isBrowser:!0,classes:{URLSearchParams:_n,FormData:mn,Blob:bn},protocols:["http","https","file","blob","url","data"]},Oe=typeof window<"u"&&typeof document<"u",we=typeof navigator=="object"&&navigator||void 0,yn=Oe&&(!we||["ReactNative","NativeScript","NS"].indexOf(we.product)<0),wn=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Sn=Oe&&window.location.href||"http://localhost",Tn=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Oe,hasStandardBrowserEnv:yn,hasStandardBrowserWebWorkerEnv:wn,navigator:we,origin:Sn},Symbol.toStringTag,{value:"Module"})),O={...Tn,...gn};function En(n,e){return le(n,new O.classes.URLSearchParams,Object.assign({visitor:function(t,s,r,i){return O.isNode&&a.isBuffer(t)?(this.append(s,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function vn(n){return a.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Rn(n){const e={},t=Object.keys(n);let s;const r=t.length;let i;for(s=0;s<r;s++)i=t[s],e[i]=n[i];return e}function it(n){function e(t,s,r,i){let o=t[i++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),u=i>=t.length;return o=!o&&a.isArray(r)?r.length:o,u?(a.hasOwnProp(r,o)?r[o]=[r[o],s]:r[o]=s,!c):((!r[o]||!a.isObject(r[o]))&&(r[o]=[]),e(t,s,r[o],i)&&a.isArray(r[o])&&(r[o]=Rn(r[o])),!c)}if(a.isFormData(n)&&a.isFunction(n.entries)){const t={};return a.forEachEntry(n,(s,r)=>{e(vn(s),r,t,0)}),t}return null}function On(n,e,t){if(a.isString(n))try{return(e||JSON.parse)(n),a.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(n)}const G={transitional:rt,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",r=s.indexOf("application/json")>-1,i=a.isObject(e);if(i&&a.isHTMLForm(e)&&(e=new FormData(e)),a.isFormData(e))return r?JSON.stringify(it(e)):e;if(a.isArrayBuffer(e)||a.isBuffer(e)||a.isStream(e)||a.isFile(e)||a.isBlob(e)||a.isReadableStream(e))return e;if(a.isArrayBufferView(e))return e.buffer;if(a.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return En(e,this.formSerializer).toString();if((c=a.isFileList(e))||s.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return le(c?{"files[]":e}:e,u&&new u,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),On(e)):e}],transformResponse:[function(e){const t=this.transitional||G.transitional,s=t&&t.forcedJSONParsing,r=this.responseType==="json";if(a.isResponse(e)||a.isReadableStream(e))return e;if(e&&a.isString(e)&&(s&&!this.responseType||r)){const o=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(c){if(o)throw c.name==="SyntaxError"?b.from(c,b.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:O.classes.FormData,Blob:O.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};a.forEach(["delete","get","head","post","put","patch"],n=>{G.headers[n]={}});const Cn=a.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),kn=n=>{const e={};let t,s,r;return n&&n.split(`
`).forEach(function(o){r=o.indexOf(":"),t=o.substring(0,r).trim().toLowerCase(),s=o.substring(r+1).trim(),!(!t||e[t]&&Cn[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},De=Symbol("internals");function H(n){return n&&String(n).trim().toLowerCase()}function Z(n){return n===!1||n==null?n:a.isArray(n)?n.map(Z):String(n)}function Pn(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(n);)e[s[1]]=s[2];return e}const xn=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function _e(n,e,t,s,r){if(a.isFunction(s))return s.call(this,e,t);if(r&&(e=t),!!a.isString(e)){if(a.isString(s))return e.indexOf(s)!==-1;if(a.isRegExp(s))return s.test(e)}}function An(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function Ln(n,e){const t=a.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+t,{value:function(r,i,o){return this[s].call(this,e,r,i,o)},configurable:!0})})}let P=class{constructor(e){e&&this.set(e)}set(e,t,s){const r=this;function i(c,u,l){const h=H(u);if(!h)throw new Error("header name must be a non-empty string");const p=a.findKey(r,h);(!p||r[p]===void 0||l===!0||l===void 0&&r[p]!==!1)&&(r[p||u]=Z(c))}const o=(c,u)=>a.forEach(c,(l,h)=>i(l,h,u));if(a.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(a.isString(e)&&(e=e.trim())&&!xn(e))o(kn(e),t);else if(a.isHeaders(e))for(const[c,u]of e.entries())i(u,c,s);else e!=null&&i(t,e,s);return this}get(e,t){if(e=H(e),e){const s=a.findKey(this,e);if(s){const r=this[s];if(!t)return r;if(t===!0)return Pn(r);if(a.isFunction(t))return t.call(this,r,s);if(a.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=H(e),e){const s=a.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||_e(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let r=!1;function i(o){if(o=H(o),o){const c=a.findKey(s,o);c&&(!t||_e(s,s[c],c,t))&&(delete s[c],r=!0)}}return a.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let s=t.length,r=!1;for(;s--;){const i=t[s];(!e||_e(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){const t=this,s={};return a.forEach(this,(r,i)=>{const o=a.findKey(s,i);if(o){t[o]=Z(r),delete t[i];return}const c=e?An(i):String(i).trim();c!==i&&delete t[i],t[c]=Z(r),s[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return a.forEach(this,(s,r)=>{s!=null&&s!==!1&&(t[r]=e&&a.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(r=>s.set(r)),s}static accessor(e){const s=(this[De]=this[De]={accessors:{}}).accessors,r=this.prototype;function i(o){const c=H(o);s[c]||(Ln(r,o),s[c]=!0)}return a.isArray(e)?e.forEach(i):i(e),this}};P.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);a.reduceDescriptors(P.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(s){this[t]=s}}});a.freezeMethods(P);function me(n,e){const t=this||G,s=e||t,r=P.from(s.headers);let i=s.data;return a.forEach(n,function(c){i=c.call(t,i,r.normalize(),e?e.status:void 0)}),r.normalize(),i}function ot(n){return!!(n&&n.__CANCEL__)}function W(n,e,t){b.call(this,n??"canceled",b.ERR_CANCELED,e,t),this.name="CanceledError"}a.inherits(W,b,{__CANCEL__:!0});function ct(n,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?n(t):e(new b("Request failed with status code "+t.status,[b.ERR_BAD_REQUEST,b.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Dn(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Nn(n,e){n=n||10;const t=new Array(n),s=new Array(n);let r=0,i=0,o;return e=e!==void 0?e:1e3,function(u){const l=Date.now(),h=s[i];o||(o=l),t[r]=u,s[r]=l;let p=i,g=0;for(;p!==r;)g+=t[p++],p=p%n;if(r=(r+1)%n,r===i&&(i=(i+1)%n),l-o<e)return;const m=h&&l-h;return m?Math.round(g*1e3/m):void 0}}function Un(n,e){let t=0,s=1e3/e,r,i;const o=(l,h=Date.now())=>{t=h,r=null,i&&(clearTimeout(i),i=null),n.apply(null,l)};return[(...l)=>{const h=Date.now(),p=h-t;p>=s?o(l,h):(r=l,i||(i=setTimeout(()=>{i=null,o(r)},s-p)))},()=>r&&o(r)]}const te=(n,e,t=3)=>{let s=0;const r=Nn(50,250);return Un(i=>{const o=i.loaded,c=i.lengthComputable?i.total:void 0,u=o-s,l=r(u),h=o<=c;s=o;const p={loaded:o,total:c,progress:c?o/c:void 0,bytes:u,rate:l||void 0,estimated:l&&c&&h?(c-o)/l:void 0,event:i,lengthComputable:c!=null,[e?"download":"upload"]:!0};n(p)},t)},Ne=(n,e)=>{const t=n!=null;return[s=>e[0]({lengthComputable:t,total:n,loaded:s}),e[1]]},Ue=n=>(...e)=>a.asap(()=>n(...e)),jn=O.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,O.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(O.origin),O.navigator&&/(msie|trident)/i.test(O.navigator.userAgent)):()=>!0,In=O.hasStandardBrowserEnv?{write(n,e,t,s,r,i){const o=[n+"="+encodeURIComponent(e)];a.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),a.isString(s)&&o.push("path="+s),a.isString(r)&&o.push("domain="+r),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Fn(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Bn(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function at(n,e,t){let s=!Fn(e);return n&&(s||t==!1)?Bn(n,e):e}const je=n=>n instanceof P?{...n}:n;function z(n,e){e=e||{};const t={};function s(l,h,p,g){return a.isPlainObject(l)&&a.isPlainObject(h)?a.merge.call({caseless:g},l,h):a.isPlainObject(h)?a.merge({},h):a.isArray(h)?h.slice():h}function r(l,h,p,g){if(a.isUndefined(h)){if(!a.isUndefined(l))return s(void 0,l,p,g)}else return s(l,h,p,g)}function i(l,h){if(!a.isUndefined(h))return s(void 0,h)}function o(l,h){if(a.isUndefined(h)){if(!a.isUndefined(l))return s(void 0,l)}else return s(void 0,h)}function c(l,h,p){if(p in e)return s(l,h);if(p in n)return s(void 0,l)}const u={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(l,h,p)=>r(je(l),je(h),p,!0)};return a.forEach(Object.keys(Object.assign({},n,e)),function(h){const p=u[h]||r,g=p(n[h],e[h],h);a.isUndefined(g)&&p!==c||(t[h]=g)}),t}const ut=n=>{const e=z({},n);let{data:t,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:i,headers:o,auth:c}=e;e.headers=o=P.from(o),e.url=st(at(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):"")));let u;if(a.isFormData(t)){if(O.hasStandardBrowserEnv||O.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((u=o.getContentType())!==!1){const[l,...h]=u?u.split(";").map(p=>p.trim()).filter(Boolean):[];o.setContentType([l||"multipart/form-data",...h].join("; "))}}if(O.hasStandardBrowserEnv&&(s&&a.isFunction(s)&&(s=s(e)),s||s!==!1&&jn(e.url))){const l=r&&i&&In.read(i);l&&o.set(r,l)}return e},zn=typeof XMLHttpRequest<"u",Mn=zn&&function(n){return new Promise(function(t,s){const r=ut(n);let i=r.data;const o=P.from(r.headers).normalize();let{responseType:c,onUploadProgress:u,onDownloadProgress:l}=r,h,p,g,m,d;function _(){m&&m(),d&&d(),r.cancelToken&&r.cancelToken.unsubscribe(h),r.signal&&r.signal.removeEventListener("abort",h)}let f=new XMLHttpRequest;f.open(r.method.toUpperCase(),r.url,!0),f.timeout=r.timeout;function w(){if(!f)return;const R=P.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders()),k={data:!c||c==="text"||c==="json"?f.responseText:f.response,status:f.status,statusText:f.statusText,headers:R,config:n,request:f};ct(function(I){t(I),_()},function(I){s(I),_()},k),f=null}"onloadend"in f?f.onloadend=w:f.onreadystatechange=function(){!f||f.readyState!==4||f.status===0&&!(f.responseURL&&f.responseURL.indexOf("file:")===0)||setTimeout(w)},f.onabort=function(){f&&(s(new b("Request aborted",b.ECONNABORTED,n,f)),f=null)},f.onerror=function(){s(new b("Network Error",b.ERR_NETWORK,n,f)),f=null},f.ontimeout=function(){let D=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const k=r.transitional||rt;r.timeoutErrorMessage&&(D=r.timeoutErrorMessage),s(new b(D,k.clarifyTimeoutError?b.ETIMEDOUT:b.ECONNABORTED,n,f)),f=null},i===void 0&&o.setContentType(null),"setRequestHeader"in f&&a.forEach(o.toJSON(),function(D,k){f.setRequestHeader(k,D)}),a.isUndefined(r.withCredentials)||(f.withCredentials=!!r.withCredentials),c&&c!=="json"&&(f.responseType=r.responseType),l&&([g,d]=te(l,!0),f.addEventListener("progress",g)),u&&f.upload&&([p,m]=te(u),f.upload.addEventListener("progress",p),f.upload.addEventListener("loadend",m)),(r.cancelToken||r.signal)&&(h=R=>{f&&(s(!R||R.type?new W(null,n,f):R),f.abort(),f=null)},r.cancelToken&&r.cancelToken.subscribe(h),r.signal&&(r.signal.aborted?h():r.signal.addEventListener("abort",h)));const v=Dn(r.url);if(v&&O.protocols.indexOf(v)===-1){s(new b("Unsupported protocol "+v+":",b.ERR_BAD_REQUEST,n));return}f.send(i||null)})},qn=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let s=new AbortController,r;const i=function(l){if(!r){r=!0,c();const h=l instanceof Error?l:this.reason;s.abort(h instanceof b?h:new W(h instanceof Error?h.message:h))}};let o=e&&setTimeout(()=>{o=null,i(new b(`timeout ${e} of ms exceeded`,b.ETIMEDOUT))},e);const c=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(l=>{l.unsubscribe?l.unsubscribe(i):l.removeEventListener("abort",i)}),n=null)};n.forEach(l=>l.addEventListener("abort",i));const{signal:u}=s;return u.unsubscribe=()=>a.asap(c),u}},Wn=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let s=0,r;for(;s<t;)r=s+e,yield n.slice(s,r),s=r},Hn=async function*(n,e){for await(const t of Jn(n))yield*Wn(t,e)},Jn=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},Ie=(n,e,t,s)=>{const r=Hn(n,e);let i=0,o,c=u=>{o||(o=!0,s&&s(u))};return new ReadableStream({async pull(u){try{const{done:l,value:h}=await r.next();if(l){c(),u.close();return}let p=h.byteLength;if(t){let g=i+=p;t(g)}u.enqueue(new Uint8Array(h))}catch(l){throw c(l),l}},cancel(u){return c(u),r.return()}},{highWaterMark:2})},he=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",lt=he&&typeof ReadableStream=="function",$n=he&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),ht=(n,...e)=>{try{return!!n(...e)}catch{return!1}},Vn=lt&&ht(()=>{let n=!1;const e=new Request(O.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Fe=64*1024,Se=lt&&ht(()=>a.isReadableStream(new Response("").body)),ne={stream:Se&&(n=>n.body)};he&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ne[e]&&(ne[e]=a.isFunction(n[e])?t=>t[e]():(t,s)=>{throw new b(`Response type '${e}' is not supported`,b.ERR_NOT_SUPPORT,s)})})})(new Response);const Kn=async n=>{if(n==null)return 0;if(a.isBlob(n))return n.size;if(a.isSpecCompliantForm(n))return(await new Request(O.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(a.isArrayBufferView(n)||a.isArrayBuffer(n))return n.byteLength;if(a.isURLSearchParams(n)&&(n=n+""),a.isString(n))return(await $n(n)).byteLength},Gn=async(n,e)=>{const t=a.toFiniteNumber(n.getContentLength());return t??Kn(e)},Xn=he&&(async n=>{let{url:e,method:t,data:s,signal:r,cancelToken:i,timeout:o,onDownloadProgress:c,onUploadProgress:u,responseType:l,headers:h,withCredentials:p="same-origin",fetchOptions:g}=ut(n);l=l?(l+"").toLowerCase():"text";let m=qn([r,i&&i.toAbortSignal()],o),d;const _=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let f;try{if(u&&Vn&&t!=="get"&&t!=="head"&&(f=await Gn(h,s))!==0){let k=new Request(e,{method:"POST",body:s,duplex:"half"}),U;if(a.isFormData(s)&&(U=k.headers.get("content-type"))&&h.setContentType(U),k.body){const[I,X]=Ne(f,te(Ue(u)));s=Ie(k.body,Fe,I,X)}}a.isString(p)||(p=p?"include":"omit");const w="credentials"in Request.prototype;d=new Request(e,{...g,signal:m,method:t.toUpperCase(),headers:h.normalize().toJSON(),body:s,duplex:"half",credentials:w?p:void 0});let v=await fetch(d);const R=Se&&(l==="stream"||l==="response");if(Se&&(c||R&&_)){const k={};["status","statusText","headers"].forEach(ke=>{k[ke]=v[ke]});const U=a.toFiniteNumber(v.headers.get("content-length")),[I,X]=c&&Ne(U,te(Ue(c),!0))||[];v=new Response(Ie(v.body,Fe,I,()=>{X&&X(),_&&_()}),k)}l=l||"text";let D=await ne[a.findKey(ne,l)||"text"](v,n);return!R&&_&&_(),await new Promise((k,U)=>{ct(k,U,{data:D,headers:P.from(v.headers),status:v.status,statusText:v.statusText,config:n,request:d})})}catch(w){throw _&&_(),w&&w.name==="TypeError"&&/fetch/i.test(w.message)?Object.assign(new b("Network Error",b.ERR_NETWORK,n,d),{cause:w.cause||w}):b.from(w,w&&w.code,n,d)}}),Te={http:hn,xhr:Mn,fetch:Xn};a.forEach(Te,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Be=n=>`- ${n}`,Qn=n=>a.isFunction(n)||n===null||n===!1,ft={getAdapter:n=>{n=a.isArray(n)?n:[n];const{length:e}=n;let t,s;const r={};for(let i=0;i<e;i++){t=n[i];let o;if(s=t,!Qn(t)&&(s=Te[(o=String(t)).toLowerCase()],s===void 0))throw new b(`Unknown adapter '${o}'`);if(s)break;r[o||"#"+i]=s}if(!s){const i=Object.entries(r).map(([c,u])=>`adapter ${c} `+(u===!1?"is not supported by the environment":"is not available in the build"));let o=e?i.length>1?`since :
`+i.map(Be).join(`
`):" "+Be(i[0]):"as no adapter specified";throw new b("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:Te};function be(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new W(null,n)}function ze(n){return be(n),n.headers=P.from(n.headers),n.data=me.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),ft.getAdapter(n.adapter||G.adapter)(n).then(function(s){return be(n),s.data=me.call(n,n.transformResponse,s),s.headers=P.from(s.headers),s},function(s){return ot(s)||(be(n),s&&s.response&&(s.response.data=me.call(n,n.transformResponse,s.response),s.response.headers=P.from(s.response.headers))),Promise.reject(s)})}const dt="1.8.4",fe={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{fe[n]=function(s){return typeof s===n||"a"+(e<1?"n ":" ")+n}});const Me={};fe.transitional=function(e,t,s){function r(i,o){return"[Axios v"+dt+"] Transitional option '"+i+"'"+o+(s?". "+s:"")}return(i,o,c)=>{if(e===!1)throw new b(r(o," has been removed"+(t?" in "+t:"")),b.ERR_DEPRECATED);return t&&!Me[o]&&(Me[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,o,c):!0}};fe.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function Zn(n,e,t){if(typeof n!="object")throw new b("options must be an object",b.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let r=s.length;for(;r-- >0;){const i=s[r],o=e[i];if(o){const c=n[i],u=c===void 0||o(c,i,n);if(u!==!0)throw new b("option "+i+" must be "+u,b.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new b("Unknown option "+i,b.ERR_BAD_OPTION)}}const Y={assertOptions:Zn,validators:fe},L=Y.validators;let B=class{constructor(e){this.defaults=e,this.interceptors={request:new Le,response:new Le}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=z(this.defaults,t);const{transitional:s,paramsSerializer:r,headers:i}=t;s!==void 0&&Y.assertOptions(s,{silentJSONParsing:L.transitional(L.boolean),forcedJSONParsing:L.transitional(L.boolean),clarifyTimeoutError:L.transitional(L.boolean)},!1),r!=null&&(a.isFunction(r)?t.paramsSerializer={serialize:r}:Y.assertOptions(r,{encode:L.function,serialize:L.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Y.assertOptions(t,{baseUrl:L.spelling("baseURL"),withXsrfToken:L.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&a.merge(i.common,i[t.method]);i&&a.forEach(["delete","get","head","post","put","patch","common"],d=>{delete i[d]}),t.headers=P.concat(o,i);const c=[];let u=!0;this.interceptors.request.forEach(function(_){typeof _.runWhen=="function"&&_.runWhen(t)===!1||(u=u&&_.synchronous,c.unshift(_.fulfilled,_.rejected))});const l=[];this.interceptors.response.forEach(function(_){l.push(_.fulfilled,_.rejected)});let h,p=0,g;if(!u){const d=[ze.bind(this),void 0];for(d.unshift.apply(d,c),d.push.apply(d,l),g=d.length,h=Promise.resolve(t);p<g;)h=h.then(d[p++],d[p++]);return h}g=c.length;let m=t;for(p=0;p<g;){const d=c[p++],_=c[p++];try{m=d(m)}catch(f){_.call(this,f);break}}try{h=ze.call(this,m)}catch(d){return Promise.reject(d)}for(p=0,g=l.length;p<g;)h=h.then(l[p++],l[p++]);return h}getUri(e){e=z(this.defaults,e);const t=at(e.baseURL,e.url,e.allowAbsoluteUrls);return st(t,e.params,e.paramsSerializer)}};a.forEach(["delete","get","head","options"],function(e){B.prototype[e]=function(t,s){return this.request(z(s||{},{method:e,url:t,data:(s||{}).data}))}});a.forEach(["post","put","patch"],function(e){function t(s){return function(i,o,c){return this.request(z(c||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}B.prototype[e]=t(),B.prototype[e+"Form"]=t(!0)});let Yn=class pt{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const s=this;this.promise.then(r=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](r);s._listeners=null}),this.promise.then=r=>{let i;const o=new Promise(c=>{s.subscribe(c),i=c}).then(r);return o.cancel=function(){s.unsubscribe(i)},o},e(function(i,o,c){s.reason||(s.reason=new W(i,o,c),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new pt(function(r){e=r}),cancel:e}}};function es(n){return function(t){return n.apply(null,t)}}function ts(n){return a.isObject(n)&&n.isAxiosError===!0}const Ee={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ee).forEach(([n,e])=>{Ee[e]=n});function _t(n){const e=new B(n),t=$e(B.prototype.request,e);return a.extend(t,B.prototype,e,{allOwnKeys:!0}),a.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return _t(z(n,r))},t}const T=_t(G);T.Axios=B;T.CanceledError=W;T.CancelToken=Yn;T.isCancel=ot;T.VERSION=dt;T.toFormData=le;T.AxiosError=b;T.Cancel=T.CanceledError;T.all=function(e){return Promise.all(e)};T.spread=es;T.isAxiosError=ts;T.mergeConfig=z;T.AxiosHeaders=P;T.formToJSON=n=>it(a.isHTMLForm(n)?new FormData(n):n);T.getAdapter=ft.getAdapter;T.HttpStatusCode=Ee;T.default=T;const{Axios:ks,AxiosError:Ps,CanceledError:xs,isCancel:As,CancelToken:Ls,VERSION:Ds,all:Ns,Cancel:Us,isAxiosError:js,spread:Is,toFormData:Fs,AxiosHeaders:Bs,HttpStatusCode:zs,formToJSON:Ms,getAdapter:qs,mergeConfig:Ws}=T;window.axios=T;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";function J(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(h){try{l(s.next(h))}catch(p){o(p)}}function u(h){try{l(s.throw(h))}catch(p){o(p)}}function l(h){h.done?i(h.value):r(h.value).then(c,u)}l((s=s.apply(n,[])).next())})}function ns(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ce={exports:{}},M=typeof Reflect=="object"?Reflect:null,qe=M&&typeof M.apply=="function"?M.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)},ee;M&&typeof M.ownKeys=="function"?ee=M.ownKeys:Object.getOwnPropertySymbols?ee=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ee=function(e){return Object.getOwnPropertyNames(e)};function ss(n){console&&console.warn&&console.warn(n)}var mt=Number.isNaN||function(e){return e!==e};function y(){y.init.call(this)}Ce.exports=y;Ce.exports.once=cs;y.EventEmitter=y;y.prototype._events=void 0;y.prototype._eventsCount=0;y.prototype._maxListeners=void 0;var We=10;function de(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(y,"defaultMaxListeners",{enumerable:!0,get:function(){return We},set:function(n){if(typeof n!="number"||n<0||mt(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");We=n}});y.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};y.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||mt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function bt(n){return n._maxListeners===void 0?y.defaultMaxListeners:n._maxListeners}y.prototype.getMaxListeners=function(){return bt(this)};y.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var r=e==="error",i=this._events;if(i!==void 0)r=r&&i.error===void 0;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var u=i[e];if(u===void 0)return!1;if(typeof u=="function")qe(u,this,t);else for(var l=u.length,h=Tt(u,l),s=0;s<l;++s)qe(h[s],this,t);return!0};function gt(n,e,t,s){var r,i,o;if(de(t),i=n._events,i===void 0?(i=n._events=Object.create(null),n._eventsCount=0):(i.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),i=n._events),o=i[e]),o===void 0)o=i[e]=t,++n._eventsCount;else if(typeof o=="function"?o=i[e]=s?[t,o]:[o,t]:s?o.unshift(t):o.push(t),r=bt(n),r>0&&o.length>r&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=n,c.type=e,c.count=o.length,ss(c)}return n}y.prototype.addListener=function(e,t){return gt(this,e,t,!1)};y.prototype.on=y.prototype.addListener;y.prototype.prependListener=function(e,t){return gt(this,e,t,!0)};function rs(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function yt(n,e,t){var s={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},r=rs.bind(s);return r.listener=t,s.wrapFn=r,r}y.prototype.once=function(e,t){return de(t),this.on(e,yt(this,e,t)),this};y.prototype.prependOnceListener=function(e,t){return de(t),this.prependListener(e,yt(this,e,t)),this};y.prototype.removeListener=function(e,t){var s,r,i,o,c;if(de(t),r=this._events,r===void 0)return this;if(s=r[e],s===void 0)return this;if(s===t||s.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,s.listener||t));else if(typeof s!="function"){for(i=-1,o=s.length-1;o>=0;o--)if(s[o]===t||s[o].listener===t){c=s[o].listener,i=o;break}if(i<0)return this;i===0?s.shift():is(s,i),s.length===1&&(r[e]=s[0]),r.removeListener!==void 0&&this.emit("removeListener",e,c||t)}return this};y.prototype.off=y.prototype.removeListener;y.prototype.removeAllListeners=function(e){var t,s,r;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var i=Object.keys(s),o;for(r=0;r<i.length;++r)o=i[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=s[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this};function wt(n,e,t){var s=n._events;if(s===void 0)return[];var r=s[e];return r===void 0?[]:typeof r=="function"?t?[r.listener||r]:[r]:t?os(r):Tt(r,r.length)}y.prototype.listeners=function(e){return wt(this,e,!0)};y.prototype.rawListeners=function(e){return wt(this,e,!1)};y.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):St.call(n,e)};y.prototype.listenerCount=St;function St(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}y.prototype.eventNames=function(){return this._eventsCount>0?ee(this._events):[]};function Tt(n,e){for(var t=new Array(e),s=0;s<e;++s)t[s]=n[s];return t}function is(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function os(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function cs(n,e){return new Promise(function(t,s){function r(o){n.removeListener(e,i),s(o)}function i(){typeof n.removeListener=="function"&&n.removeListener("error",r),t([].slice.call(arguments))}Et(n,e,i,{once:!0}),e!=="error"&&as(n,r,{once:!0})})}function as(n,e,t){typeof n.on=="function"&&Et(n,"error",e,t)}function Et(n,e,t,s){if(typeof n.on=="function")s.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function r(i){s.once&&n.removeEventListener(e,r),t(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var us=Ce.exports,vt=ns(us),S;(function(n){n[n.timeout=1]="timeout",n[n.transportClosed=2]="transportClosed",n[n.clientDisconnected=3]="clientDisconnected",n[n.clientClosed=4]="clientClosed",n[n.clientConnectToken=5]="clientConnectToken",n[n.clientRefreshToken=6]="clientRefreshToken",n[n.subscriptionUnsubscribed=7]="subscriptionUnsubscribed",n[n.subscriptionSubscribeToken=8]="subscriptionSubscribeToken",n[n.subscriptionRefreshToken=9]="subscriptionRefreshToken",n[n.transportWriteError=10]="transportWriteError",n[n.connectionClosed=11]="connectionClosed",n[n.badConfiguration=12]="badConfiguration"})(S||(S={}));var j;(function(n){n[n.connectCalled=0]="connectCalled",n[n.transportClosed=1]="transportClosed",n[n.noPing=2]="noPing",n[n.subscribeTimeout=3]="subscribeTimeout",n[n.unsubscribeError=4]="unsubscribeError"})(j||(j={}));var $;(function(n){n[n.disconnectCalled=0]="disconnectCalled",n[n.unauthorized=1]="unauthorized",n[n.badProtocol=2]="badProtocol",n[n.messageSizeLimit=3]="messageSizeLimit"})($||($={}));var se;(function(n){n[n.subscribeCalled=0]="subscribeCalled",n[n.transportClosed=1]="transportClosed"})(se||(se={}));var re;(function(n){n[n.unsubscribeCalled=0]="unsubscribeCalled",n[n.unauthorized=1]="unauthorized",n[n.clientClosed=2]="clientClosed"})(re||(re={}));var E;(function(n){n.Disconnected="disconnected",n.Connecting="connecting",n.Connected="connected"})(E||(E={}));var C;(function(n){n.Unsubscribed="unsubscribed",n.Subscribing="subscribing",n.Subscribed="subscribed"})(C||(C={}));function ls(n,e){return n.lastIndexOf(e,0)===0}function Rt(n){return n==null?!1:typeof n=="function"}function hs(n,e){if(globalThis.console){const t=globalThis.console[n];Rt(t)&&t.apply(globalThis.console,e)}}function fs(n,e){return Math.floor(Math.random()*(e-n+1)+n)}function ie(n,e,t){n>31&&(n=31);const s=fs(0,Math.min(t,e*Math.pow(2,n)));return Math.min(t,e+s)}function ds(n){return"error"in n&&n.error!==null}function oe(n){return Math.min(n*1e3,2147483647)}class ps extends vt{constructor(e,t,s){super(),this._resubscribeTimeout=null,this._refreshTimeout=null,this.channel=t,this.state=C.Unsubscribed,this._centrifuge=e,this._token="",this._getToken=null,this._data=null,this._getData=null,this._recover=!1,this._offset=null,this._epoch=null,this._recoverable=!1,this._positioned=!1,this._joinLeave=!1,this._minResubscribeDelay=500,this._maxResubscribeDelay=2e4,this._resubscribeTimeout=null,this._resubscribeAttempts=0,this._promises={},this._promiseId=0,this._inflight=!1,this._refreshTimeout=null,this._delta="",this._delta_negotiated=!1,this._prevValue=null,this._unsubPromise=Promise.resolve(),this._setOptions(s),this._centrifuge._debugEnabled?(this.on("state",r=>{this._debug("subscription state",t,r.oldState,"->",r.newState)}),this.on("error",r=>{this._debug("subscription error",t,r)})):this.on("error",function(){Function.prototype()})}ready(e){return this.state===C.Unsubscribed?Promise.reject({code:S.subscriptionUnsubscribed,message:this.state}):this.state===C.Subscribed?Promise.resolve():new Promise((t,s)=>{const r={resolve:t,reject:s};e&&(r.timeout=setTimeout(function(){s({code:S.timeout,message:"timeout"})},e)),this._promises[this._nextPromiseId()]=r})}subscribe(){this._isSubscribed()||(this._resubscribeAttempts=0,this._setSubscribing(se.subscribeCalled,"subscribe called"))}unsubscribe(){this._unsubPromise=this._setUnsubscribed(re.unsubscribeCalled,"unsubscribe called",!0)}publish(e){const t=this;return this._methodCall().then(function(){return t._centrifuge.publish(t.channel,e)})}presence(){const e=this;return this._methodCall().then(function(){return e._centrifuge.presence(e.channel)})}presenceStats(){const e=this;return this._methodCall().then(function(){return e._centrifuge.presenceStats(e.channel)})}history(e){const t=this;return this._methodCall().then(function(){return t._centrifuge.history(t.channel,e)})}_methodCall(){return this._isSubscribed()?Promise.resolve():this._isUnsubscribed()?Promise.reject({code:S.subscriptionUnsubscribed,message:this.state}):new Promise((e,t)=>{const s=setTimeout(function(){t({code:S.timeout,message:"timeout"})},this._centrifuge._config.timeout);this._promises[this._nextPromiseId()]={timeout:s,resolve:e,reject:t}})}_nextPromiseId(){return++this._promiseId}_needRecover(){return this._recover===!0}_isUnsubscribed(){return this.state===C.Unsubscribed}_isSubscribing(){return this.state===C.Subscribing}_isSubscribed(){return this.state===C.Subscribed}_setState(e){if(this.state!==e){const t=this.state;return this.state=e,this.emit("state",{newState:e,oldState:t,channel:this.channel}),!0}return!1}_usesToken(){return this._token!==""||this._getToken!==null}_clearSubscribingState(){this._resubscribeAttempts=0,this._clearResubscribeTimeout()}_clearSubscribedState(){this._clearRefreshTimeout()}_setSubscribed(e){if(!this._isSubscribing())return;this._clearSubscribingState(),e.recoverable&&(this._recover=!0,this._offset=e.offset||0,this._epoch=e.epoch||""),e.delta?this._delta_negotiated=!0:this._delta_negotiated=!1,this._setState(C.Subscribed);const t=this._centrifuge._getSubscribeContext(this.channel,e);this.emit("subscribed",t),this._resolvePromises();const s=e.publications;if(s&&s.length>0)for(const r in s)s.hasOwnProperty(r)&&this._handlePublication(s[r]);e.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),oe(e.ttl)))}_setSubscribing(e,t){return J(this,void 0,void 0,function*(){this._isSubscribing()||(this._isSubscribed()&&this._clearSubscribedState(),this._setState(C.Subscribing)&&this.emit("subscribing",{channel:this.channel,code:e,reason:t}),this._centrifuge._transport&&this._centrifuge._transport.emulation()&&(yield this._unsubPromise),this._isSubscribing()&&this._subscribe())})}_subscribe(){return this._debug("subscribing on",this.channel),this._isTransportOpen()?this._inflight?null:(this._inflight=!0,this._canSubscribeWithoutGettingToken()?this._subscribeWithoutToken():(this._getSubscriptionToken().then(e=>this._handleTokenResponse(e)).catch(e=>this._handleTokenError(e)),null)):(this._debug("delay subscribe on",this.channel,"till connected"),null)}_isTransportOpen(){return this._centrifuge._transportIsOpen}_canSubscribeWithoutGettingToken(){return!this._usesToken()||!!this._token}_subscribeWithoutToken(){return this._getData?(this._getDataAndSubscribe(this._token),null):this._sendSubscribe(this._token)}_getDataAndSubscribe(e){if(!this._getData){this._inflight=!1;return}this._getData({channel:this.channel}).then(t=>{if(!this._isSubscribing()){this._inflight=!1;return}this._data=t,this._sendSubscribe(e)}).catch(t=>this._handleGetDataError(t))}_handleGetDataError(e){if(!this._isSubscribing()){this._inflight=!1;return}if(e instanceof N){this._inflight=!1,this._failUnauthorized();return}this.emit("error",{type:"subscribeData",channel:this.channel,error:{code:S.badConfiguration,message:(e==null?void 0:e.toString())||""}}),this._inflight=!1,this._scheduleResubscribe()}_handleTokenResponse(e){if(!this._isSubscribing()){this._inflight=!1;return}if(!e){this._inflight=!1,this._failUnauthorized();return}this._token=e,this._getData?this._getDataAndSubscribe(e):this._sendSubscribe(e)}_handleTokenError(e){if(!this._isSubscribing()){this._inflight=!1;return}if(e instanceof N){this._inflight=!1,this._failUnauthorized();return}this.emit("error",{type:"subscribeToken",channel:this.channel,error:{code:S.subscriptionSubscribeToken,message:(e==null?void 0:e.toString())||""}}),this._inflight=!1,this._scheduleResubscribe()}_sendSubscribe(e){if(!this._isTransportOpen())return this._inflight=!1,null;const t=this._buildSubscribeCommand(e);return this._centrifuge._call(t).then(s=>{this._inflight=!1;const r=s.reply.subscribe;this._handleSubscribeResponse(r),s.next&&s.next()},s=>{this._inflight=!1,this._handleSubscribeError(s.error),s.next&&s.next()}),t}_buildSubscribeCommand(e){const t={channel:this.channel};if(e&&(t.token=e),this._data&&(t.data=this._data),this._positioned&&(t.positioned=!0),this._recoverable&&(t.recoverable=!0),this._joinLeave&&(t.join_leave=!0),this._needRecover()){t.recover=!0;const s=this._getOffset();s&&(t.offset=s);const r=this._getEpoch();r&&(t.epoch=r)}return this._delta&&(t.delta=this._delta),{subscribe:t}}_debug(...e){this._centrifuge._debug(...e)}_handleSubscribeError(e){if(this._isSubscribing()){if(e.code===S.timeout){this._centrifuge._disconnect(j.subscribeTimeout,"subscribe timeout",!0);return}this._subscribeError(e)}}_handleSubscribeResponse(e){this._isSubscribing()&&this._setSubscribed(e)}_setUnsubscribed(e,t,s){if(this._isUnsubscribed())return Promise.resolve();let r=Promise.resolve();return this._isSubscribed()?(s&&(r=this._centrifuge._unsubscribe(this)),this._clearSubscribedState()):this._isSubscribing()&&(this._inflight&&s&&(r=this._centrifuge._unsubscribe(this)),this._clearSubscribingState()),this._inflight=!1,this._setState(C.Unsubscribed)&&this.emit("unsubscribed",{channel:this.channel,code:e,reason:t}),this._rejectPromises({code:S.subscriptionUnsubscribed,message:this.state}),r}_handlePublication(e){if(this._delta&&this._delta_negotiated){const{newData:s,newPrevValue:r}=this._centrifuge._codec.applyDeltaIfNeeded(e,this._prevValue);e.data=s,this._prevValue=r}const t=this._centrifuge._getPublicationContext(this.channel,e);this.emit("publication",t),e.offset&&(this._offset=e.offset)}_handleJoin(e){const t=this._centrifuge._getJoinLeaveContext(e.info);this.emit("join",{channel:this.channel,info:t})}_handleLeave(e){const t=this._centrifuge._getJoinLeaveContext(e.info);this.emit("leave",{channel:this.channel,info:t})}_resolvePromises(){for(const e in this._promises)this._promises.hasOwnProperty(e)&&(this._promises[e].timeout&&clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e])}_rejectPromises(e){for(const t in this._promises)this._promises.hasOwnProperty(t)&&(this._promises[t].timeout&&clearTimeout(this._promises[t].timeout),this._promises[t].reject(e),delete this._promises[t])}_scheduleResubscribe(){if(!this._isSubscribing()){this._debug("not in subscribing state, skip resubscribe scheduling",this.channel);return}const e=this,t=this._getResubscribeDelay();this._resubscribeTimeout=setTimeout(function(){e._isSubscribing()&&e._subscribe()},t),this._debug("resubscribe scheduled after "+t,this.channel)}_subscribeError(e){if(this._isSubscribing())if(e.code<100||e.code===109||e.temporary===!0){e.code===109&&(this._token="");const t={channel:this.channel,type:"subscribe",error:e};this._centrifuge.state===E.Connected&&this.emit("error",t),this._scheduleResubscribe()}else this._setUnsubscribed(e.code,e.message,!1)}_getResubscribeDelay(){const e=ie(this._resubscribeAttempts,this._minResubscribeDelay,this._maxResubscribeDelay);return this._resubscribeAttempts++,e}_setOptions(e){if(e&&(e.since&&(this._offset=e.since.offset,this._epoch=e.since.epoch,this._recover=!0),e.data&&(this._data=e.data),e.getData&&(this._getData=e.getData),e.minResubscribeDelay!==void 0&&(this._minResubscribeDelay=e.minResubscribeDelay),e.maxResubscribeDelay!==void 0&&(this._maxResubscribeDelay=e.maxResubscribeDelay),e.token&&(this._token=e.token),e.getToken&&(this._getToken=e.getToken),e.positioned===!0&&(this._positioned=!0),e.recoverable===!0&&(this._recoverable=!0),e.joinLeave===!0&&(this._joinLeave=!0),e.delta)){if(e.delta!=="fossil")throw new Error("unsupported delta format");this._delta=e.delta}}_getOffset(){const e=this._offset;return e!==null?e:0}_getEpoch(){const e=this._epoch;return e!==null?e:""}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearResubscribeTimeout(){this._resubscribeTimeout!==null&&(clearTimeout(this._resubscribeTimeout),this._resubscribeTimeout=null)}_getSubscriptionToken(){this._debug("get subscription token for channel",this.channel);const e={channel:this.channel},t=this._getToken;if(t===null)throw this.emit("error",{type:"configuration",channel:this.channel,error:{code:S.badConfiguration,message:"provide a function to get channel subscription token"}}),new N("");return t(e)}_refresh(){this._clearRefreshTimeout();const e=this;this._getSubscriptionToken().then(function(t){if(!e._isSubscribed())return;if(!t){e._failUnauthorized();return}e._token=t;const r={sub_refresh:{channel:e.channel,token:t}};e._centrifuge._call(r).then(i=>{const o=i.reply.sub_refresh;e._refreshResponse(o),i.next&&i.next()},i=>{e._refreshError(i.error),i.next&&i.next()})}).catch(function(t){if(t instanceof N){e._failUnauthorized();return}e.emit("error",{type:"refreshToken",channel:e.channel,error:{code:S.subscriptionRefreshToken,message:t!==void 0?t.toString():""}}),e._refreshTimeout=setTimeout(()=>e._refresh(),e._getRefreshRetryDelay())})}_refreshResponse(e){this._isSubscribed()&&(this._debug("subscription token refreshed, channel",this.channel),this._clearRefreshTimeout(),e.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),oe(e.ttl))))}_refreshError(e){this._isSubscribed()&&(e.code<100||e.temporary===!0?(this.emit("error",{type:"refresh",channel:this.channel,error:e}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._setUnsubscribed(e.code,e.message,!0))}_getRefreshRetryDelay(){return ie(0,1e4,2e4)}_failUnauthorized(){this._setUnsubscribed(re.unauthorized,"unauthorized",!0)}}class _s{constructor(e,t){this.endpoint=e,this.options=t,this._transport=null}name(){return"sockjs"}subName(){return"sockjs-"+this._transport.transport}emulation(){return!1}supported(){return this.options.sockjs!==null}initialize(e,t){this._transport=new this.options.sockjs(this.endpoint,null,this.options.sockjsOptions),this._transport.onopen=()=>{t.onOpen()},this._transport.onerror=s=>{t.onError(s)},this._transport.onclose=s=>{t.onClose(s)},this._transport.onmessage=s=>{t.onMessage(s.data)}}close(){this._transport.close()}send(e){this._transport.send(e)}}class He{constructor(e,t){this.endpoint=e,this.options=t,this._transport=null}name(){return"websocket"}subName(){return"websocket"}emulation(){return!1}supported(){return this.options.websocket!==void 0&&this.options.websocket!==null}initialize(e,t){let s="";e==="protobuf"&&(s="centrifuge-protobuf"),s!==""?this._transport=new this.options.websocket(this.endpoint,s):this._transport=new this.options.websocket(this.endpoint),e==="protobuf"&&(this._transport.binaryType="arraybuffer"),this._transport.onopen=()=>{t.onOpen()},this._transport.onerror=r=>{t.onError(r)},this._transport.onclose=r=>{t.onClose(r)},this._transport.onmessage=r=>{t.onMessage(r.data)}}close(){this._transport.close()}send(e){this._transport.send(e)}}class ms{constructor(e,t){this.endpoint=e,this.options=t,this._abortController=null,this._utf8decoder=new TextDecoder,this._protocol="json"}name(){return"http_stream"}subName(){return"http_stream"}emulation(){return!0}_handleErrors(e){if(!e.ok)throw new Error(e.status);return e}_fetchEventTarget(e,t,s){const r=new EventTarget,i=e.options.fetch;return i(t,s).then(e._handleErrors).then(o=>{r.dispatchEvent(new Event("open"));let c="",u=0,l=new Uint8Array;const h=o.body.getReader();return new e.options.readableStream({start(p){function g(){return h.read().then(({done:m,value:d})=>{if(m){r.dispatchEvent(new Event("close")),p.close();return}try{if(e._protocol==="json")for(c+=e._utf8decoder.decode(d);u<c.length;)if(c[u]===`
`){const _=c.substring(0,u);r.dispatchEvent(new MessageEvent("message",{data:_})),c=c.substring(u+1),u=0}else++u;else{const _=new Uint8Array(l.length+d.length);for(_.set(l),_.set(d,l.length),l=_;;){const f=e.options.decoder.decodeReply(l);if(f.ok){const w=l.slice(0,f.pos);r.dispatchEvent(new MessageEvent("message",{data:w})),l=l.slice(f.pos);continue}break}}}catch(_){r.dispatchEvent(new Event("error",{detail:_})),r.dispatchEvent(new Event("close")),p.close();return}g()}).catch(function(m){r.dispatchEvent(new Event("error",{detail:m})),r.dispatchEvent(new Event("close")),p.close()})}return g()}})}).catch(o=>{r.dispatchEvent(new Event("error",{detail:o})),r.dispatchEvent(new Event("close"))}),r}supported(){return this.options.fetch!==null&&this.options.readableStream!==null&&typeof TextDecoder<"u"&&typeof AbortController<"u"&&typeof EventTarget<"u"&&typeof Event<"u"&&typeof MessageEvent<"u"&&typeof Error<"u"}initialize(e,t,s){this._protocol=e,this._abortController=new AbortController;let r,i;e==="json"?(r={Accept:"application/json","Content-Type":"application/json"},i=s):(r={Accept:"application/octet-stream","Content-Type":"application/octet-stream"},i=s);const o={method:"POST",headers:r,body:i,mode:"cors",credentials:"same-origin",signal:this._abortController.signal},c=this._fetchEventTarget(this,this.endpoint,o);c.addEventListener("open",()=>{t.onOpen()}),c.addEventListener("error",u=>{this._abortController.abort(),t.onError(u)}),c.addEventListener("close",()=>{this._abortController.abort(),t.onClose({code:4,reason:"connection closed"})}),c.addEventListener("message",u=>{t.onMessage(u.data)})}close(){this._abortController.abort()}send(e,t,s){let r,i;const o={session:t,node:s,data:e};this._protocol==="json"?(r={"Content-Type":"application/json"},i=JSON.stringify(o)):(r={"Content-Type":"application/octet-stream"},i=this.options.encoder.encodeEmulationRequest(o));const c=this.options.fetch,u={method:"POST",headers:r,body:i,mode:"cors",credentials:"same-origin"};c(this.options.emulationEndpoint,u)}}class bs{constructor(e,t){this.endpoint=e,this.options=t,this._protocol="json",this._transport=null,this._onClose=null}name(){return"sse"}subName(){return"sse"}emulation(){return!0}supported(){return this.options.eventsource!==null&&this.options.fetch!==null}initialize(e,t,s){let r;globalThis&&globalThis.document&&globalThis.document.baseURI?r=new URL(this.endpoint,globalThis.document.baseURI):r=new URL(this.endpoint),r.searchParams.append("cf_connect",s);const i={},o=new this.options.eventsource(r.toString(),i);this._transport=o;const c=this;o.onopen=function(){t.onOpen()},o.onerror=function(u){o.close(),t.onError(u),t.onClose({code:4,reason:"connection closed"})},o.onmessage=function(u){t.onMessage(u.data)},c._onClose=function(){t.onClose({code:4,reason:"connection closed"})}}close(){this._transport.close(),this._onClose!==null&&this._onClose()}send(e,t,s){const r={session:t,node:s,data:e},i={"Content-Type":"application/json"},o=JSON.stringify(r),c=this.options.fetch,u={method:"POST",headers:i,body:o,mode:"cors",credentials:"same-origin"};c(this.options.emulationEndpoint,u)}}class gs{constructor(e,t){this.endpoint=e,this.options=t,this._transport=null,this._stream=null,this._writer=null,this._utf8decoder=new TextDecoder,this._protocol="json"}name(){return"webtransport"}subName(){return"webtransport"}emulation(){return!1}supported(){return this.options.webtransport!==void 0&&this.options.webtransport!==null}initialize(e,t){return J(this,void 0,void 0,function*(){let s;globalThis&&globalThis.document&&globalThis.document.baseURI?s=new URL(this.endpoint,globalThis.document.baseURI):s=new URL(this.endpoint),e==="protobuf"&&s.searchParams.append("cf_protocol","protobuf"),this._protocol=e;const r=new EventTarget;this._transport=new this.options.webtransport(s.toString()),this._transport.closed.then(()=>{t.onClose({code:4,reason:"connection closed"})}).catch(()=>{t.onClose({code:4,reason:"connection closed"})});try{yield this._transport.ready}catch{this.close();return}let i;try{i=yield this._transport.createBidirectionalStream()}catch{this.close();return}this._stream=i,this._writer=this._stream.writable.getWriter(),r.addEventListener("close",()=>{t.onClose({code:4,reason:"connection closed"})}),r.addEventListener("message",o=>{t.onMessage(o.data)}),this._startReading(r),t.onOpen()})}_startReading(e){return J(this,void 0,void 0,function*(){const t=this._stream.readable.getReader();let s="",r=0,i=new Uint8Array;try{for(;;){const{done:o,value:c}=yield t.read();if(c.length>0)if(this._protocol==="json")for(s+=this._utf8decoder.decode(c);r<s.length;)if(s[r]===`
`){const u=s.substring(0,r);e.dispatchEvent(new MessageEvent("message",{data:u})),s=s.substring(r+1),r=0}else++r;else{const u=new Uint8Array(i.length+c.length);for(u.set(i),u.set(c,i.length),i=u;;){const l=this.options.decoder.decodeReply(i);if(l.ok){const h=i.slice(0,l.pos);e.dispatchEvent(new MessageEvent("message",{data:h})),i=i.slice(l.pos);continue}break}}if(o)break}}catch{e.dispatchEvent(new Event("close"))}})}close(){return J(this,void 0,void 0,function*(){try{this._writer&&(yield this._writer.close()),this._transport.close()}catch{}})}send(e){return J(this,void 0,void 0,function*(){let t;this._protocol==="json"?t=new TextEncoder().encode(e+`
`):t=e;try{yield this._writer.write(t)}catch{this.close()}})}}const ys=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];class ws{constructor(e){this.a=e,this.pos=0}haveBytes(){return this.pos<this.a.length}getByte(){const e=this.a[this.pos];if(this.pos++,this.pos>this.a.length)throw new RangeError("out of bounds");return e}getChar(){return String.fromCharCode(this.getByte())}getInt(){let e=0,t;for(;this.haveBytes()&&(t=ys[127&this.getByte()])>=0;)e=(e<<6)+t;return this.pos--,e>>>0}}class Ss{constructor(){this.a=[]}toByteArray(e){return Array.isArray(e)?this.a:new Uint8Array(this.a)}putArray(e,t,s){for(let r=t;r<s;r++)this.a.push(e[r])}}function Ts(n){let e=0,t=0,s=0,r=0,i=0,o=n.length;for(;o>=16;)e=e+n[i+0]|0,t=t+n[i+1]|0,s=s+n[i+2]|0,r=r+n[i+3]|0,e=e+n[i+4]|0,t=t+n[i+5]|0,s=s+n[i+6]|0,r=r+n[i+7]|0,e=e+n[i+8]|0,t=t+n[i+9]|0,s=s+n[i+10]|0,r=r+n[i+11]|0,e=e+n[i+12]|0,t=t+n[i+13]|0,s=s+n[i+14]|0,r=r+n[i+15]|0,i+=16,o-=16;for(;o>=4;)e=e+n[i+0]|0,t=t+n[i+1]|0,s=s+n[i+2]|0,r=r+n[i+3]|0,i+=4,o-=4;switch(r=((r+(s<<8)|0)+(t<<16)|0)+(e<<24)|0,o){case 3:r=r+(n[i+2]<<8)|0;case 2:r=r+(n[i+1]<<16)|0;case 1:r=r+(n[i+0]<<24)|0}return r>>>0}function Es(n,e){let t=0;const s=new ws(e),r=n.length,i=e.length,o=s.getInt();if(s.getChar()!==`
`)throw new Error("size integer not terminated by '\\n'");const c=new Ss;for(;s.haveBytes();){const u=s.getInt();let l;switch(s.getChar()){case"@":if(l=s.getInt(),s.haveBytes()&&s.getChar()!==",")throw new Error("copy command not terminated by ','");if(t+=u,t>o)throw new Error("copy exceeds output file size");if(l+u>r)throw new Error("copy extends past end of input");c.putArray(n,l,l+u);break;case":":if(t+=u,t>o)throw new Error("insert command gives an output larger than predicted");if(u>i)throw new Error("insert count exceeds size of delta");c.putArray(s.a,s.pos,s.pos+u),s.pos+=u;break;case";":{const h=c.toByteArray(n);if(u!==Ts(h))throw new Error("bad checksum");if(t!==o)throw new Error("generated size does not match predicted size");return h}default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")}class Je{name(){return"json"}encodeCommands(e){return e.map(t=>JSON.stringify(t)).join(`
`)}decodeReplies(e){return e.trim().split(`
`).map(t=>JSON.parse(t))}applyDeltaIfNeeded(e,t){let s,r;if(e.delta){const i=Es(t,new TextEncoder().encode(e.data));s=JSON.parse(new TextDecoder().decode(i)),r=i}else s=JSON.parse(e.data),r=new TextEncoder().encode(e.data);return{newData:s,newPrevValue:r}}}const vs={headers:{},token:"",getToken:null,data:null,getData:null,debug:!1,name:"js",version:"",fetch:null,readableStream:null,websocket:null,eventsource:null,sockjs:null,sockjsOptions:{},emulationEndpoint:"/emulation",minReconnectDelay:500,maxReconnectDelay:2e4,timeout:5e3,maxServerPingDelay:1e4,networkEventTarget:null};class N extends Error{constructor(e){super(e),this.name=this.constructor.name}}class pe extends vt{constructor(e,t){super(),this._reconnectTimeout=null,this._refreshTimeout=null,this._serverPingTimeout=null,this.state=E.Disconnected,this._transportIsOpen=!1,this._endpoint=e,this._emulation=!1,this._transports=[],this._currentTransportIndex=0,this._triedAllTransports=!1,this._transportWasOpen=!1,this._transport=null,this._transportId=0,this._deviceWentOffline=!1,this._transportClosed=!0,this._codec=new Je,this._reconnecting=!1,this._reconnectTimeout=null,this._reconnectAttempts=0,this._client=null,this._session="",this._node="",this._subs={},this._serverSubs={},this._commandId=0,this._commands=[],this._batching=!1,this._refreshRequired=!1,this._refreshTimeout=null,this._callbacks={},this._token="",this._data=null,this._dispatchPromise=Promise.resolve(),this._serverPing=0,this._serverPingTimeout=null,this._sendPong=!1,this._promises={},this._promiseId=0,this._debugEnabled=!1,this._networkEventsSet=!1,this._config=Object.assign(Object.assign({},vs),t),this._configure(),this._debugEnabled?(this.on("state",s=>{this._debug("client state",s.oldState,"->",s.newState)}),this.on("error",s=>{this._debug("client error",s)})):this.on("error",function(){Function.prototype()})}newSubscription(e,t){if(this.getSubscription(e)!==null)throw new Error("Subscription to the channel "+e+" already exists");const s=new ps(this,e,t);return this._subs[e]=s,s}getSubscription(e){return this._getSub(e)}removeSubscription(e){e&&(e.state!==C.Unsubscribed&&e.unsubscribe(),this._removeSubscription(e))}subscriptions(){return this._subs}ready(e){return this.state===E.Disconnected?Promise.reject({code:S.clientDisconnected,message:"client disconnected"}):this.state===E.Connected?Promise.resolve():new Promise((t,s)=>{const r={resolve:t,reject:s};e&&(r.timeout=setTimeout(function(){s({code:S.timeout,message:"timeout"})},e)),this._promises[this._nextPromiseId()]=r})}connect(){if(this._isConnected()){this._debug("connect called when already connected");return}if(this._isConnecting()){this._debug("connect called when already connecting");return}this._debug("connect called"),this._reconnectAttempts=0,this._startConnecting()}disconnect(){this._disconnect($.disconnectCalled,"disconnect called",!1)}setToken(e){this._token=e}setHeaders(e){this._config.headers=e}send(e){const t={send:{data:e}},s=this;return this._methodCall().then(function(){return s._transportSendCommands([t])?Promise.resolve():Promise.reject(s._createErrorObject(S.transportWriteError,"transport write error"))})}rpc(e,t){const s={rpc:{method:e,data:t}},r=this;return this._methodCall().then(function(){return r._callPromise(s,function(i){return{data:i.rpc.data}})})}publish(e,t){const s={publish:{channel:e,data:t}},r=this;return this._methodCall().then(function(){return r._callPromise(s,function(){return{}})})}history(e,t){const s={history:this._getHistoryRequest(e,t)},r=this;return this._methodCall().then(function(){return r._callPromise(s,function(i){const o=i.history,c=[];if(o.publications)for(let u=0;u<o.publications.length;u++)c.push(r._getPublicationContext(e,o.publications[u]));return{publications:c,epoch:o.epoch||"",offset:o.offset||0}})})}presence(e){const t={presence:{channel:e}},s=this;return this._methodCall().then(function(){return s._callPromise(t,function(r){const i=r.presence.presence;for(const o in i)if(i.hasOwnProperty(o)){const c=i[o].conn_info,u=i[o].chan_info;c&&(i[o].connInfo=c),u&&(i[o].chanInfo=u)}return{clients:i}})})}presenceStats(e){const t={presence_stats:{channel:e}},s=this;return this._methodCall().then(function(){return s._callPromise(t,function(r){const i=r.presence_stats;return{numUsers:i.num_users,numClients:i.num_clients}})})}startBatching(){this._batching=!0}stopBatching(){const e=this;Promise.resolve().then(function(){Promise.resolve().then(function(){e._batching=!1,e._flush()})})}_debug(...e){this._debugEnabled&&hs("debug",e)}_formatOverride(){}_configure(){if(!("Promise"in globalThis))throw new Error("Promise polyfill required");if(!this._endpoint)throw new Error("endpoint configuration required");if(this._config.token!==null&&(this._token=this._config.token),this._config.data!==null&&(this._data=this._config.data),this._codec=new Je,this._formatOverride(),(this._config.debug===!0||typeof localStorage<"u"&&localStorage.getItem("centrifuge.debug"))&&(this._debugEnabled=!0),this._debug("config",this._config),typeof this._endpoint!="string")if(typeof this._endpoint=="object"&&this._endpoint instanceof Array){this._transports=this._endpoint,this._emulation=!0;for(const e in this._transports)if(this._transports.hasOwnProperty(e)){const t=this._transports[e];if(!t.endpoint||!t.transport)throw new Error("malformed transport configuration");const s=t.transport;if(["websocket","http_stream","sse","sockjs","webtransport"].indexOf(s)<0)throw new Error("unsupported transport name: "+s)}}else throw new Error("unsupported url configuration type: only string or array of objects are supported")}_setState(e){if(this.state!==e){this._reconnecting=!1;const t=this.state;return this.state=e,this.emit("state",{newState:e,oldState:t}),!0}return!1}_isDisconnected(){return this.state===E.Disconnected}_isConnecting(){return this.state===E.Connecting}_isConnected(){return this.state===E.Connected}_nextCommandId(){return++this._commandId}_setNetworkEvents(){if(this._networkEventsSet)return;let e=null;this._config.networkEventTarget!==null?e=this._config.networkEventTarget:typeof globalThis.addEventListener<"u"&&(e=globalThis),e&&(e.addEventListener("offline",()=>{this._debug("offline event triggered"),(this.state===E.Connected||this.state===E.Connecting)&&(this._disconnect(j.transportClosed,"transport closed",!0),this._deviceWentOffline=!0)}),e.addEventListener("online",()=>{this._debug("online event triggered"),this.state===E.Connecting&&(this._deviceWentOffline&&!this._transportClosed&&(this._deviceWentOffline=!1,this._transportClosed=!0),this._clearReconnectTimeout(),this._startReconnecting())}),this._networkEventsSet=!0)}_getReconnectDelay(){const e=ie(this._reconnectAttempts,this._config.minReconnectDelay,this._config.maxReconnectDelay);return this._reconnectAttempts+=1,e}_clearOutgoingRequests(){for(const e in this._callbacks)if(this._callbacks.hasOwnProperty(e)){const t=this._callbacks[e];clearTimeout(t.timeout);const s=t.errback;if(!s)continue;s({error:this._createErrorObject(S.connectionClosed,"connection closed")})}this._callbacks={}}_clearConnectedState(){this._client=null,this._clearServerPingTimeout(),this._clearRefreshTimeout();for(const e in this._subs){if(!this._subs.hasOwnProperty(e))continue;const t=this._subs[e];t.state===C.Subscribed&&t._setSubscribing(se.transportClosed,"transport closed")}for(const e in this._serverSubs)this._serverSubs.hasOwnProperty(e)&&this.emit("subscribing",{channel:e})}_handleWriteError(e){for(const t of e){const s=t.id;if(!(s in this._callbacks))continue;const r=this._callbacks[s];clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s];const i=r.errback;i({error:this._createErrorObject(S.transportWriteError,"transport write error")})}}_transportSendCommands(e){if(!e.length)return!0;if(!this._transport)return!1;try{this._transport.send(this._codec.encodeCommands(e),this._session,this._node)}catch(t){return this._debug("error writing commands",t),this._handleWriteError(e),!1}return!0}_initializeTransport(){let e;this._config.websocket!==null?e=this._config.websocket:typeof globalThis.WebSocket!="function"&&typeof globalThis.WebSocket!="object"||(e=globalThis.WebSocket);let t=null;this._config.sockjs!==null?t=this._config.sockjs:typeof globalThis.SockJS<"u"&&(t=globalThis.SockJS);let s=null;this._config.eventsource!==null?s=this._config.eventsource:typeof globalThis.EventSource<"u"&&(s=globalThis.EventSource);let r=null;this._config.fetch!==null?r=this._config.fetch:typeof globalThis.fetch<"u"&&(r=globalThis.fetch);let i=null;if(this._config.readableStream!==null?i=this._config.readableStream:typeof globalThis.ReadableStream<"u"&&(i=globalThis.ReadableStream),this._emulation){this._currentTransportIndex>=this._transports.length&&(this._triedAllTransports=!0,this._currentTransportIndex=0);let m=0;for(;;){if(m>=this._transports.length)throw new Error("no supported transport found");const d=this._transports[this._currentTransportIndex],_=d.transport,f=d.endpoint;if(_==="websocket"){if(this._debug("trying websocket transport"),this._transport=new He(f,{websocket:e}),!this._transport.supported()){this._debug("websocket transport not available"),this._currentTransportIndex++,m++;continue}}else if(_==="webtransport"){if(this._debug("trying webtransport transport"),this._transport=new gs(f,{webtransport:globalThis.WebTransport,decoder:this._codec,encoder:this._codec}),!this._transport.supported()){this._debug("webtransport transport not available"),this._currentTransportIndex++,m++;continue}}else if(_==="http_stream"){if(this._debug("trying http_stream transport"),this._transport=new ms(f,{fetch:r,readableStream:i,emulationEndpoint:this._config.emulationEndpoint,decoder:this._codec,encoder:this._codec}),!this._transport.supported()){this._debug("http_stream transport not available"),this._currentTransportIndex++,m++;continue}}else if(_==="sse"){if(this._debug("trying sse transport"),this._transport=new bs(f,{eventsource:s,fetch:r,emulationEndpoint:this._config.emulationEndpoint}),!this._transport.supported()){this._debug("sse transport not available"),this._currentTransportIndex++,m++;continue}}else if(_==="sockjs"){if(this._debug("trying sockjs"),this._transport=new _s(f,{sockjs:t,sockjsOptions:this._config.sockjsOptions}),!this._transport.supported()){this._debug("sockjs transport not available"),this._currentTransportIndex++,m++;continue}}else throw new Error("unknown transport "+_);break}}else{if(ls(this._endpoint,"http"))throw new Error("Provide explicit transport endpoints configuration in case of using HTTP (i.e. using array of TransportEndpoint instead of a single string), or use ws(s):// scheme in an endpoint if you aimed using WebSocket transport");if(this._debug("client will use websocket"),this._transport=new He(this._endpoint,{websocket:e}),!this._transport.supported())throw new Error("WebSocket constructor not found, make sure it is available globally or passed as a dependency in Centrifuge options")}const o=this,c=this._transport,u=this._nextTransportId();o._debug("id of transport",u);let l=!1;const h=[];if(this._transport.emulation()){const m=o._sendConnect(!0);h.push(m)}this._setNetworkEvents();const p=this._codec.encodeCommands(h);this._transportClosed=!1;let g;g=setTimeout(function(){c.close()},this._config.timeout),this._transport.initialize(this._codec.name(),{onOpen:function(){if(g&&(clearTimeout(g),g=null),o._transportId!=u){o._debug("open callback from non-actual transport"),c.close();return}l=!0,o._debug(c.subName(),"transport open"),!c.emulation()&&(o._transportIsOpen=!0,o._transportWasOpen=!0,o.startBatching(),o._sendConnect(!1),o._sendSubscribeCommands(),o.stopBatching(),o.emit("__centrifuge_debug:connect_frame_sent",{}))},onError:function(m){if(o._transportId!=u){o._debug("error callback from non-actual transport");return}o._debug("transport level error",m)},onClose:function(m){if(g&&(clearTimeout(g),g=null),o._transportId!=u){o._debug("close callback from non-actual transport");return}o._debug(c.subName(),"transport closed"),o._transportClosed=!0,o._transportIsOpen=!1;let d="connection closed",_=!0,f=0;if(m&&"code"in m&&m.code&&(f=m.code),m&&m.reason)try{const w=JSON.parse(m.reason);d=w.reason,_=w.reconnect}catch{d=m.reason,(f>=3500&&f<4e3||f>=4500&&f<5e3)&&(_=!1)}f<3e3?(f===1009?(f=$.messageSizeLimit,d="message size limit exceeded",_=!1):(f=j.transportClosed,d="transport closed"),o._emulation&&!o._transportWasOpen&&(o._currentTransportIndex++,o._currentTransportIndex>=o._transports.length&&(o._triedAllTransports=!0,o._currentTransportIndex=0))):o._transportWasOpen=!0,o._isConnecting()&&!l&&o.emit("error",{type:"transport",error:{code:S.transportClosed,message:"transport closed"},transport:c.name()}),o._reconnecting=!1,o._disconnect(f,d,_)},onMessage:function(m){o._dataReceived(m)}},p),o.emit("__centrifuge_debug:transport_initialized",{})}_sendConnect(e){const t=this._constructConnectCommand(),s=this;return this._call(t,e).then(r=>{const i=r.reply.connect;s._connectResponse(i),r.next&&r.next()},r=>{s._connectError(r.error),r.next&&r.next()}),t}_startReconnecting(){if(this._debug("start reconnecting"),!this._isConnecting()){this._debug("stop reconnecting: client not in connecting state");return}if(this._reconnecting){this._debug("reconnect already in progress, return from reconnect routine");return}if(this._transportClosed===!1){this._debug("waiting for transport close");return}this._reconnecting=!0;const e=this._token==="";if(!(this._refreshRequired||e&&this._config.getToken!==null)){this._config.getData?this._config.getData().then(r=>{this._isConnecting()&&(this._data=r,this._initializeTransport())}).catch(r=>this._handleGetDataError(r)):this._initializeTransport();return}const s=this;this._getToken().then(function(r){if(s._isConnecting()){if(r==null||r==null){s._failUnauthorized();return}s._token=r,s._debug("connection token refreshed"),s._config.getData?s._config.getData().then(function(i){s._isConnecting()&&(s._data=i,s._initializeTransport())}).catch(i=>s._handleGetDataError(i)):s._initializeTransport()}}).catch(function(r){if(!s._isConnecting())return;if(r instanceof N){s._failUnauthorized();return}s.emit("error",{type:"connectToken",error:{code:S.clientConnectToken,message:r!==void 0?r.toString():""}});const i=s._getReconnectDelay();s._debug("error on getting connection token, reconnect after "+i+" milliseconds",r),s._reconnecting=!1,s._reconnectTimeout=setTimeout(()=>{s._startReconnecting()},i)})}_handleGetDataError(e){if(e instanceof N){this._failUnauthorized();return}this.emit("error",{type:"connectData",error:{code:S.badConfiguration,message:(e==null?void 0:e.toString())||""}});const t=this._getReconnectDelay();this._debug("error on getting connect data, reconnect after "+t+" milliseconds",e),this._reconnecting=!1,this._reconnectTimeout=setTimeout(()=>{this._startReconnecting()},t)}_connectError(e){this.state===E.Connecting&&(e.code===109&&(this._refreshRequired=!0),e.code<100||e.temporary===!0||e.code===109?(this.emit("error",{type:"connect",error:e}),this._debug("closing transport due to connect error"),this._disconnect(e.code,e.message,!0)):this._disconnect(e.code,e.message,!1))}_scheduleReconnect(){if(!this._isConnecting())return;let e=!1;this._emulation&&!this._transportWasOpen&&!this._triedAllTransports&&(e=!0);let t=this._getReconnectDelay();e&&(t=0),this._debug("reconnect after "+t+" milliseconds"),this._clearReconnectTimeout(),this._reconnectTimeout=setTimeout(()=>{this._startReconnecting()},t)}_constructConnectCommand(){const e={};this._token&&(e.token=this._token),this._data&&(e.data=this._data),this._config.name&&(e.name=this._config.name),this._config.version&&(e.version=this._config.version),Object.keys(this._config.headers).length>0&&(e.headers=this._config.headers);const t={};let s=!1;for(const r in this._serverSubs)if(this._serverSubs.hasOwnProperty(r)&&this._serverSubs[r].recoverable){s=!0;const i={recover:!0};this._serverSubs[r].offset&&(i.offset=this._serverSubs[r].offset),this._serverSubs[r].epoch&&(i.epoch=this._serverSubs[r].epoch),t[r]=i}return s&&(e.subs=t),{connect:e}}_getHistoryRequest(e,t){const s={channel:e};return t!==void 0&&(t.since&&(s.since={offset:t.since.offset},t.since.epoch&&(s.since.epoch=t.since.epoch)),t.limit!==void 0&&(s.limit=t.limit),t.reverse===!0&&(s.reverse=!0)),s}_methodCall(){return this._isConnected()?Promise.resolve():new Promise((e,t)=>{const s=setTimeout(function(){t({code:S.timeout,message:"timeout"})},this._config.timeout);this._promises[this._nextPromiseId()]={timeout:s,resolve:e,reject:t}})}_callPromise(e,t){return new Promise((s,r)=>{this._call(e,!1).then(i=>{s(t(i.reply)),i.next&&i.next()},i=>{r(i.error),i.next&&i.next()})})}_dataReceived(e){this._serverPing>0&&this._waitServerPing();const t=this._codec.decodeReplies(e);this._dispatchPromise=this._dispatchPromise.then(()=>{let s;this._dispatchPromise=new Promise(r=>{s=r}),this._dispatchSynchronized(t,s)})}_dispatchSynchronized(e,t){let s=Promise.resolve();for(const r in e)e.hasOwnProperty(r)&&(s=s.then(()=>this._dispatchReply(e[r])));s=s.then(()=>{t()})}_dispatchReply(e){let t;const s=new Promise(i=>{t=i});if(e==null)return this._debug("dispatch: got undefined or null reply"),t(),s;const r=e.id;return r&&r>0?this._handleReply(e,t):e.push?this._handlePush(e.push,t):this._handleServerPing(t),s}_call(e,t){return new Promise((s,r)=>{e.id=this._nextCommandId(),this._registerCall(e.id,s,r),t||this._addCommand(e)})}_startConnecting(){this._debug("start connecting"),this._setState(E.Connecting)&&this.emit("connecting",{code:j.connectCalled,reason:"connect called"}),this._client=null,this._startReconnecting()}_disconnect(e,t,s){if(this._isDisconnected())return;this._transportIsOpen=!1;const r=this.state;this._reconnecting=!1;const i={code:e,reason:t};let o=!1;if(s?o=this._setState(E.Connecting):(o=this._setState(E.Disconnected),this._rejectPromises({code:S.clientDisconnected,message:"disconnected"})),this._clearOutgoingRequests(),r===E.Connecting&&this._clearReconnectTimeout(),r===E.Connected&&this._clearConnectedState(),o&&(this._isConnecting()?this.emit("connecting",i):this.emit("disconnected",i)),this._transport){this._debug("closing existing transport");const c=this._transport;this._transport=null,c.close(),this._transportClosed=!0,this._nextTransportId()}else this._debug("no transport to close");this._scheduleReconnect()}_failUnauthorized(){this._disconnect($.unauthorized,"unauthorized",!1)}_getToken(){if(this._debug("get connection token"),!this._config.getToken)throw this.emit("error",{type:"configuration",error:{code:S.badConfiguration,message:"token expired but no getToken function set in the configuration"}}),new N("");return this._config.getToken({})}_refresh(){const e=this._client,t=this;this._getToken().then(function(s){if(e!==t._client)return;if(!s){t._failUnauthorized();return}if(t._token=s,t._debug("connection token refreshed"),!t._isConnected())return;const r={refresh:{token:t._token}};t._call(r,!1).then(i=>{const o=i.reply.refresh;t._refreshResponse(o),i.next&&i.next()},i=>{t._refreshError(i.error),i.next&&i.next()})}).catch(function(s){if(t._isConnected()){if(s instanceof N){t._failUnauthorized();return}t.emit("error",{type:"refreshToken",error:{code:S.clientRefreshToken,message:s!==void 0?s.toString():""}}),t._refreshTimeout=setTimeout(()=>t._refresh(),t._getRefreshRetryDelay())}})}_refreshError(e){e.code<100||e.temporary===!0?(this.emit("error",{type:"refresh",error:e}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._disconnect(e.code,e.message,!1)}_getRefreshRetryDelay(){return ie(0,5e3,1e4)}_refreshResponse(e){this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),e.expires&&(this._client=e.client,this._refreshTimeout=setTimeout(()=>this._refresh(),oe(e.ttl)))}_removeSubscription(e){e!==null&&delete this._subs[e.channel]}_unsubscribe(e){if(!this._transportIsOpen)return Promise.resolve();const s={unsubscribe:{channel:e.channel}},r=this;return new Promise((o,c)=>{this._call(s,!1).then(u=>{o(),u.next&&u.next()},u=>{o(),u.next&&u.next(),r._disconnect(j.unsubscribeError,"unsubscribe error",!0)})})}_getSub(e){const t=this._subs[e];return t||null}_isServerSub(e){return this._serverSubs[e]!==void 0}_sendSubscribeCommands(){const e=[];for(const t in this._subs){if(!this._subs.hasOwnProperty(t))continue;const s=this._subs[t];if(s._inflight!==!0&&s.state===C.Subscribing){const r=s._subscribe();r&&e.push(r)}}return e}_connectResponse(e){if(this._transportIsOpen=!0,this._transportWasOpen=!0,this._reconnectAttempts=0,this._refreshRequired=!1,this._isConnected())return;this._client=e.client,this._setState(E.Connected),this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires&&(this._refreshTimeout=setTimeout(()=>this._refresh(),oe(e.ttl))),this._session=e.session,this._node=e.node,this.startBatching(),this._sendSubscribeCommands(),this.stopBatching();const t={client:e.client,transport:this._transport.subName()};e.data&&(t.data=e.data),this.emit("connected",t),this._resolvePromises(),this._processServerSubs(e.subs||{}),e.ping&&e.ping>0?(this._serverPing=e.ping*1e3,this._sendPong=e.pong===!0,this._waitServerPing()):this._serverPing=0}_processServerSubs(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const s=e[t];this._serverSubs[t]={offset:s.offset,epoch:s.epoch,recoverable:s.recoverable||!1};const r=this._getSubscribeContext(t,s);this.emit("subscribed",r)}for(const t in e){if(!e.hasOwnProperty(t))continue;const s=e[t];if(s.recovered){const r=s.publications;if(r&&r.length>0)for(const i in r)r.hasOwnProperty(i)&&this._handlePublication(t,r[i])}}for(const t in this._serverSubs)this._serverSubs.hasOwnProperty(t)&&(e[t]||(this.emit("unsubscribed",{channel:t}),delete this._serverSubs[t]))}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearReconnectTimeout(){this._reconnectTimeout!==null&&(clearTimeout(this._reconnectTimeout),this._reconnectTimeout=null)}_clearServerPingTimeout(){this._serverPingTimeout!==null&&(clearTimeout(this._serverPingTimeout),this._serverPingTimeout=null)}_waitServerPing(){this._config.maxServerPingDelay!==0&&this._isConnected()&&(this._clearServerPingTimeout(),this._serverPingTimeout=setTimeout(()=>{this._isConnected()&&this._disconnect(j.noPing,"no ping",!0)},this._serverPing+this._config.maxServerPingDelay))}_getSubscribeContext(e,t){const s={channel:e,positioned:!1,recoverable:!1,wasRecovering:!1,recovered:!1};t.recovered&&(s.recovered=!0),t.positioned&&(s.positioned=!0),t.recoverable&&(s.recoverable=!0),t.was_recovering&&(s.wasRecovering=!0);let r="";"epoch"in t&&(r=t.epoch);let i=0;return"offset"in t&&(i=t.offset),(s.positioned||s.recoverable)&&(s.streamPosition={offset:i,epoch:r}),t.data&&(s.data=t.data),s}_handleReply(e,t){const s=e.id;if(!(s in this._callbacks)){t();return}const r=this._callbacks[s];if(clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s],ds(e)){const i=r.errback;if(!i){t();return}const o=e.error;i({error:o,next:t})}else{const i=r.callback;if(!i)return;i({reply:e,next:t})}}_handleJoin(e,t){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const r={channel:e,info:this._getJoinLeaveContext(t.info)};this.emit("join",r)}return}s._handleJoin(t)}_handleLeave(e,t){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const r={channel:e,info:this._getJoinLeaveContext(t.info)};this.emit("leave",r)}return}s._handleLeave(t)}_handleUnsubscribe(e,t){const s=this._getSub(e);if(!s){this._isServerSub(e)&&(delete this._serverSubs[e],this.emit("unsubscribed",{channel:e}));return}t.code<2500?s._setUnsubscribed(t.code,t.reason,!1):s._setSubscribing(t.code,t.reason)}_handleSubscribe(e,t){this._serverSubs[e]={offset:t.offset,epoch:t.epoch,recoverable:t.recoverable||!1},this.emit("subscribed",this._getSubscribeContext(e,t))}_handleDisconnect(e){const t=e.code;let s=!0;(t>=3500&&t<4e3||t>=4500&&t<5e3)&&(s=!1),this._disconnect(t,e.reason,s)}_getPublicationContext(e,t){const s={channel:e,data:t.data};return t.offset&&(s.offset=t.offset),t.info&&(s.info=this._getJoinLeaveContext(t.info)),t.tags&&(s.tags=t.tags),s}_getJoinLeaveContext(e){const t={client:e.client,user:e.user};return e.conn_info&&(t.connInfo=e.conn_info),e.chan_info&&(t.chanInfo=e.chan_info),t}_handlePublication(e,t){const s=this._getSub(e);if(!s){if(this._isServerSub(e)){const r=this._getPublicationContext(e,t);this.emit("publication",r),t.offset!==void 0&&(this._serverSubs[e].offset=t.offset)}return}s._handlePublication(t)}_handleMessage(e){this.emit("message",{data:e.data})}_handleServerPing(e){if(this._sendPong){const t={};this._transportSendCommands([t])}e()}_handlePush(e,t){const s=e.channel;e.pub?this._handlePublication(s,e.pub):e.message?this._handleMessage(e.message):e.join?this._handleJoin(s,e.join):e.leave?this._handleLeave(s,e.leave):e.unsubscribe?this._handleUnsubscribe(s,e.unsubscribe):e.subscribe?this._handleSubscribe(s,e.subscribe):e.disconnect&&this._handleDisconnect(e.disconnect),t()}_flush(){const e=this._commands.slice(0);this._commands=[],this._transportSendCommands(e)}_createErrorObject(e,t,s){const r={code:e,message:t};return s&&(r.temporary=!0),r}_registerCall(e,t,s){this._callbacks[e]={callback:t,errback:s,timeout:null},this._callbacks[e].timeout=setTimeout(()=>{delete this._callbacks[e],Rt(s)&&s({error:this._createErrorObject(S.timeout,"timeout")})},this._config.timeout)}_addCommand(e){this._batching?this._commands.push(e):this._transportSendCommands([e])}_nextPromiseId(){return++this._promiseId}_nextTransportId(){return++this._transportId}_resolvePromises(){for(const e in this._promises)this._promises.hasOwnProperty(e)&&(this._promises[e].timeout&&clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e])}_rejectPromises(e){for(const t in this._promises)this._promises.hasOwnProperty(t)&&(this._promises[t].timeout&&clearTimeout(this._promises[t].timeout),this._promises[t].reject(e),delete this._promises[t])}}pe.SubscriptionState=C;pe.State=E;pe.UnauthorizedError=N;document.addEventListener("moonshine:init",async()=>{if(!window.MoonShine){console.error("MoonShine is not initialized");return}let n=await Rs();const e=new pe("ws://localhost:8001/connection/websocket",{token:n});e.on("connected",()=>{document.dispatchEvent(new CustomEvent("moonshine:rush"))}).connect(),window.MoonShine.onCallback("onMoonShineWS",function(t,s){if(e.getSubscription(t)!==null)return;e.newSubscription(t).on("publication",function(i){s(i.data)}).on("subscribing",()=>{document.dispatchEvent(new CustomEvent("rush-subscribe:"))}).on("error",i=>{console.log(i)}).subscribe()}),window.MoonShine.onCallback("rushPublish",function(t,s){e.publish(t,s).then().catch(r=>{console.error("Failed to publish message:",r)})})});async function Rs(){const n=localStorage.getItem("centrifugo_token"),e=localStorage.getItem("centrifugo_token_expiration"),t=Math.floor(Date.now()/1e3);if(n&&e&&parseInt(e)>t+300)return n;try{const r=(await T.post("/centrifugo/token")).data.token,[,i]=r.split("."),c=JSON.parse(atob(i)).exp||0;return localStorage.setItem("centrifugo_token",r),localStorage.setItem("centrifugo_token_expiration",c.toString()),r}catch(s){throw console.error("Failed to get Centrifugo token:",s),s}}
